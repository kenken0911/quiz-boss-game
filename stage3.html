<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sustainability Quest üó°Ô∏è - Stage 3</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Press+Start+2P&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <style>
    body[lang="ja"], body[lang="zh"] { font-family: 'DotGothic16', sans-serif; }
    body[lang="en"] { font-family: 'Press Start 2P', cursive; }
    body { background-color: #000; color: #fff; image-rendering: pixelated; overflow-x: hidden; overflow-y: auto; }
    /* ‚òÖÂ§âÊõ¥: „Ç¶„Ç£„É≥„Éâ„Ç¶„ÅÆËâ≤„ÇíÊ∞¥Ëâ≤„ÉÜ„Éº„Éû„Å´ */
    .dq-window { border: 4px solid #fff; background: rgba(0, 0, 80, 0.85); padding: 1.5rem; box-shadow: 0 0 0 4px #000, 0 0 20px rgba(0, 128, 255, 0.6); backdrop-filter: blur(3px); }
    /* ‚òÖÂ§âÊõ¥: „Éú„Çø„É≥„ÅÆËâ≤„ÇíÊ∞¥Ëâ≤„ÉÜ„Éº„Éû„Å´ */
    .dq-button { cursor: pointer; padding: .75rem 1.5rem; border: 2px solid #fff; background-image: linear-gradient(to bottom, #0055dd, #0033aa); text-shadow: 1px 1px 2px #000; transition: all 0.2s; }
    .dq-button:hover { background-image: linear-gradient(to bottom, #4488ff, #0055dd); box-shadow: 0 0 10px #fff; }
    .video-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
    .bg-video { width: 100%; height: 100%; object-fit: cover; }
    /* ‚òÖÂ§âÊõ¥: „Çø„Ç§„Éà„É´„Ç∑„É£„Éâ„Ç¶„ÅÆËâ≤„ÇíÊ∞¥Ëâ≤„ÉÜ„Éº„Éû„Å´ */
    #title-screen h1 { font-size: 2.5rem; font-weight: bold; text-shadow: 0 0 5px #fff, 0 0 15px #fff, 0 0 25px #00aaff; animation: fadeInTitle 2s ease-out forwards; }
    #title-start-button { animation: pulseButton 2.5s infinite ease-in-out; }
    @keyframes fadeInTitle { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    @keyframes pulseButton { 0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(255,255,255,0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,1); } }
    .boss-hp-container { border: 2px solid #fff; height: 30px; padding: 3px; background: #333; border-radius: 5px; box-shadow: inset 0 0 5px #000; }
    .boss-hp-bar { height: 100%; transition: width .5s ease-out, background-image .5s ease-out; border-radius: 2px; }
    .boss-hp-bar.full { background-image: linear-gradient(to right, #33ff33, #88ff88); }
    .boss-hp-bar.mid { background-image: linear-gradient(to right, #ffff33, #ffff88); }
    .boss-hp-bar.low { background-image: linear-gradient(to right, #ff3333, #ff8833); }
    .boss-idle { animation: boss-float 2.5s infinite ease-in-out; }
    @keyframes boss-float{ 0%,100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
    .boss-defeat { animation: boss-defeat-anim 1.5s forwards; }
    @keyframes boss-defeat-anim { 0% { opacity: 1; transform: rotate(0deg); } 50% { opacity: 1; transform: rotate(10deg); } 100% { opacity: 0; transform: translateY(100px) rotate(-20deg) scale(0.5); } }
    .shake { animation: shake .35s; }
    @keyframes shake { 10%,90% { transform: translate(-2px, -2px); } 20%,80% { transform: translate(3px, 2px); } 30%,50%,70% { transform: translate(-3px, 3px); } 40%,60% { transform: translate(3px, -2px); } }
    /* ‚òÖÂ§âÊõ¥: „Éú„Çπ„ÅÆ„Ç™„Éº„É©„ÇíÊ∞¥Ëâ≤„ÉÜ„Éº„Éû„Å´ */
    .gov-glow { filter: drop-shadow(0 0 8px #00aaff) drop-shadow(0 0 16px #00ffff) contrast(1.5); }
    #boss-img { width: 100%; max-width: 320px; height: auto; }
    .correct-answer { background-image: linear-gradient(to bottom, #ffdd00, #ffaa00) !important; color: #000; }
    .incorrect-answer { background-image: linear-gradient(to bottom, #888888, #555555) !important; opacity: 0.7; }
  </style>
</head>
<body class="flex items-start sm:items-center justify-center min-h-screen p-4">

  <div id="opening-video-container" class="video-container">
    <video id="opening-video" class="bg-video" src="./opening_movie.mp4" autoplay loop playsinline onerror="handleMediaError(this)"></video>
  </div>
  <div id="game-video-container" class="video-container hidden">
    <video id="game-bg-video" class="bg-video" src="./GameBackground3.mp4" autoplay muted loop playsinline onerror="handleMediaError(this)"></video>
  </div>

  <div class="w-full max-w-3xl mx-auto">
    <div id="boss-area" class="mb-4 h-64 flex justify-center items-end relative hidden">
      <div id="boss-container"><img id="boss-img" src="./Stage3_dragon.png" alt="„Éú„Çπ„ÅÆÁîªÂÉè" class="gov-glow" onerror="handleMediaError(this)"/></div>
    </div>
    <div id="game-container" class="w-full dq-window relative">
      <div id="title-screen" class="text-center py-8">
        <h1 class="mb-10">Sustainability Quest</h1>
        <button id="title-start-button" class="dq-button">START</button>
      </div>

      <div id="language-screen" class="text-center hidden">
        <h1 class="text-3xl font-bold mb-6">Select Language</h1>
        <p class="text-sm mb-6">Translations are provided by AI.</p>
        <div class="flex justify-center gap-2 flex-wrap">
          <button id="lang-ja" class="dq-button">Êó•Êú¨Ë™û</button>
          <button id="lang-en" class="dq-button">English</button>
          <button id="lang-zh" class="dq-button">‰∏≠Êñá</button>
        </div>
      </div>

      <div id="instruction-screen" class="text-center hidden">
        <h1 id="instruction-title" class="text-3xl font-bold mb-4"></h1>
        <div id="instruction-text" class="text-left mb-6 space-y-2"></div>
        <button id="instruction-ok-button" class="dq-button"></button>
      </div>
      
      <div id="start-screen" class="text-center hidden">
        <h1 id="title-text" class="text-2xl font-bold mb-4"></h1>
        <div class="flex flex-col items-center gap-4 mb-4">
          <select id="companySelect" class="text-black px-3 py-2 w-full md:w-80 text-center rounded"></select>
          <input id="employeeIdInput" type="text" pattern="\d{5}" title="Á§æÂì°Áï™Âè∑„ÅØÂçäËßíÊï∞Â≠ó5Ê°Å„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="text-black px-3 py-2 w-full md:w-80 text-center rounded" />
        </div>
        <button id="start-button" class="dq-button inline-flex items-center gap-2"><span id="start-button-text"></span></button>
        <div id="msg" class="text-yellow-300 text-sm h-5 mt-2"></div>
      </div>

      <div id="quiz-screen" class="hidden">
        <div class="flex justify-between items-center mb-2 text-lg">
          <span id="theme-display"></span>
          <span id="progress-display"></span>
          <span id="timer-display">0.0s</span>
        </div>
        <div class="mb-4"><p id="boss-hp-label"></p><div class="boss-hp-container"><div id="boss-hp-bar"></div></div></div>
        <div class="mb-4 min-h-[80px] p-4 border-2 border-white"><p id="question-text" class="text-xl"></p></div>
        <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
      </div>
      <div id="result-screen" class="hidden text-center">
        <h2 id="result-title" class="text-3xl font-bold mb-4"></h2>
        <p id="result-message" class="text-xl mb-6"></p>
        <p id="submission-status" class="text-yellow-300 mb-8"></p>
        <div id="restart-button" class="dq-button inline-block"></div>
      </div>
      <div id="explanation-modal" class="absolute inset-0 bg-black bg-opacity-80 flex-col items-center justify-center p-4 hidden">
        <div class="dq-window w-full max-w-2xl text-center">
          <h2 id="explanation-title" class="text-4xl font-bold mb-4"></h2>
          <p id="explanation-text" class="text-lg mb-6 text-left h-48 overflow-y-auto p-2 border"></p>
          <button id="next-question-button" class="dq-button"></button>
        </div>
      </div>
    </div>
  </div>
  <audio id="bgm" src="./BS3_BGM.wav" loop onerror="handleMediaError(this)"></audio>
  <audio id="correct-sound" src="./correct_answer.mp3" onerror="handleMediaError(this)"></audio>
  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbyJSdEy7FB8URSCuHC9DoFPHzPOcMS7TVnyFJ-4IGRunK09fLbwSdQxUGQDM0vOZ7wNmA/exec';
    const STAGE_NUMBER = '3';
    const TEXTS = {
      ja: {
        instructionTitle: "ÂÜíÈô∫„ÅÆÂøÉÂæó",
        instructions: ["„Éª„Çµ„Çπ„ÉÜ„Éä„Éì„É™„ÉÜ„Ç£„Å´Èñ¢„Åô„Çã5„Å§„ÅÆÂïèÈ°å„ÅåÂá∫È°å„Åï„Çå„Çã„Åû„ÄÇ", "„Éª4Âïè‰ª•‰∏äÊ≠£Ëß£„Åß„Éú„Çπ„ÇíË®é‰ºê„Åß„Åç„ÇãÔºÅ", "„ÉªÂêÑ„Çπ„ÉÜ„Éº„Ç∏„ÅÆÊúÄÂàù„ÅÆÊåëÊà¶ÁµêÊûú„ÅÆ„Åø„ÅåË®òÈå≤„Åï„Çå„Çã„Åû„ÄÇ", "„ÉªÂÅ•Èóò„ÇíÁ•à„ÇãÔºÅ"],
        instructionOk: "„Çè„Åã„Å£„Åü",
        title: "„Çπ„ÉÜ„Éº„Ç∏3Ôºö„Ç¨„Éê„Éä„É≥„Çπ",
        employeeIdPlaceholder: "Á§æÂì°Áï™Âè∑(ÂçäËßí5Ê°Å)„ÇíÂÖ•Âäõ",
        companySelectDefault: "ÊâÄÂ±û‰ºöÁ§æ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
        startButton: "ÊåëÊà¶„Åô„Çã",
        msgEnterId: "ÊâÄÂ±û‰ºöÁ§æ„Å®Á§æÂì°Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
        msgCheckingId: "ÊåëÊà¶Ë≥áÊ†º„ÇíÁ¢∫Ë™ç‰∏≠...",
        msgIdNotFound: "„Çπ„ÉÜ„Éº„Ç∏1„ÅÆË®òÈå≤„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ‰ºöÁ§æÂêç„Å®Á§æÂì°Áï™Âè∑„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        msgCheckError: "Á¢∫Ë™ç„Ç®„É©„Éº„ÄÇÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        theme: "„ÉÜ„Éº„ÉûÔºö„Ç¨„Éê„Éä„É≥„Çπ",
        progress: (q, t) => `${q}/${t}ÂïèÁõÆ`,
        bossHp: "„Éú„Çπ HP",
        resultWinTitle: "ÂãùÂà©ÔºÅ",
        resultWinMsg: "„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ„Ç¨„Éê„Éä„É≥„Çπ„Å∏„ÅÆÊÑèË≠ò„ÅåÈ´ò„Åæ„Å£„ÅüÔºÅ",
        resultLoseTitle: "„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº",
        resultLoseMsg: "Á´ú„ÅÆÁü•ÊÅµ„ÅØÊ∑±„Åã„Å£„Åü‚Ä¶",
        submitting: "ÁµêÊûú„ÇíÈÄÅ‰ø°‰∏≠...",
        submitSuccess: "ÁµêÊûú„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„ÅüÔºÅ",
        submitError: "„Ç®„É©„ÉºÔºöÁµêÊûú„ÇíÈÄÅ‰ø°„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ",
        recordedFalse: "„Éó„É¨„Ç§„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅË®òÈå≤„ÅØÂàùÂõû„ÅÆ„ÇÇ„ÅÆ„ÅÆ„Åø„Å®„Å™„Çä„Åæ„Åô„ÄÇ",
        restartButton: "„Çø„Ç§„Éà„É´„Å∏Êàª„Çã",
        correct: "Ê≠£Ëß£ÔºÅ",
        incorrect: "‰∏çÊ≠£Ëß£...",
        nextButton: "Ê¨°„Å∏",
        quiz: [
          { q: "‰ºÅÊ•≠„ÅåESG(Áí∞Â¢É„ÉªÁ§æ‰ºö„Éª‰ºÅÊ•≠Áµ±Ê≤ªÔºâ„Å´Âèñ„ÇäÁµÑ„ÇÄ„Åì„Å®„Å´„Çà„Å£„Å¶Âæó„Çâ„Çå„Çã„É°„É™„ÉÉ„Éà„Å®„Åó„Å¶„ÄÅË™§„Å£„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„ÅØÊ¨°„ÅÆ„ÅÜ„Å°„Å©„Çå„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["È°ßÂÆ¢„ÉªÂ∏ÇÂ†¥„Åã„ÇâÂìÅË≥™„ÇÑ‰æ°Ê†º‰ª•Â§ñ„ÅÆË¶ÅÁ¥†„Åß„ÇÇÈÅ∏„Å∞„Çå„Çã„Çà„ÅÜ„Å™‰∫ãÊ•≠Á´∂‰∫âÂäõ„ÇíÂæó„Çâ„Çå„Çã„Åì„Å®„ÄÇ", "Á§æ‰ºöË™≤È°åËµ∑ÁÇπ„ÅÆÊñ∞„Åü„Å™„Éì„Ç∏„Éç„ÇπÂâµÂá∫Á≠â„Å´„Çà„Çä„ÄÅ‰∫ãÊ•≠ÊàêÈï∑„Å®„Çà„Çä„Çà„ÅÑÁí∞Â¢É„ÇÑÁ§æ‰ºö„Å®„ÅÆ‰∏°Á´ã„ÇíÂÆüÁèæ„Åß„Åç„Çã„Åì„Å®„ÄÇ", "Ë£úÂä©ÈáëÁ≠â„ÇíÂæó„ÇÑ„Åô„Åè„Å™„Çã„Åì„Å®„Åß„ÄÅÁü≠ÊúüÁöÑ„Å™Âà©Áõä„ÇíÊúÄÂ§ßÂåñ„Åß„Åç„Çã„Åì„Å®„ÄÇ", "ÂÑ™ÁßÄ„Å™‰∫∫Ë≤°„ÅÆÊé°Áî®„ÇÑË≥áÈáëË™øÈÅî„Å´„Åä„ÅÑ„Å¶ÊúâÂà©„Å´ÂÉç„Åè„Åì„Å®„ÄÇ"], a: "Ë£úÂä©ÈáëÁ≠â„ÇíÂæó„ÇÑ„Åô„Åè„Å™„Çã„Åì„Å®„Åß„ÄÅÁü≠ÊúüÁöÑ„Å™Âà©Áõä„ÇíÊúÄÂ§ßÂåñ„Åß„Åç„Çã„Åì„Å®„ÄÇ", ex: "ESG„Å∏„ÅÆÂèñ„ÇäÁµÑ„Åø„ÅØ„ÄÅÈï∑ÊúüÁöÑ„Å™‰ºÅÊ•≠‰æ°ÂÄ§„ÅÆÂêë‰∏ä„Å®ÊåÅÁ∂öÂèØËÉΩ„Å™ÊàêÈï∑„ÇíÁõÆÊåá„Åô„ÇÇ„ÅÆ„Åß„Åô„ÄÇÁü≠ÊúüÁöÑ„Å™Âà©Áõä„ÅÆÊúÄÂ§ßÂåñ„ÇíÂîØ‰∏Ä„ÅÆÁõÆÁöÑ„Å®„Åô„Çã„Åì„Å®„ÅØ„ÄÅESG„ÅÆÊú¨Êù•„ÅÆÁõÆÁöÑ„Å®„ÅØÁï∞„Å™„Çä„Åæ„Åô„ÄÇNKC„Ç∞„É´„Éº„Éó„Åß„ÇÇ„ÄåNKC Sustainability Vision 2024„Äç„Å´„Åä„ÅÑ„Å¶„ÄÅ„Çµ„Çπ„ÉÜ„Éä„Éì„É™„ÉÜ„Ç£Êà¶Áï•„Çí‰∫ãÊ•≠Êà¶Áï•„Å®ËûçÂêà„Åï„ÅõÊñ∞„Åü„Å™„ÄåÊàêÈï∑Êà¶Áï•„Äç„Å®„Åô„Çã„Åì„Å®„ÇíÁõÆÊåá„Åô„Åì„Å®„ÇíÁ§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ" },
          { q: "NKC„Ç∞„É´„Éº„Éó„Å´„Åä„ÅÑ„Å¶„ÄÅÁ§æÂì°„Å´Á©çÊ•µÁöÑ„Å´Á§æ‰ºöË≤¢ÁåÆÊ¥ªÂãï„Å´ÂèÇÂä†„Åô„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Å¶„ÅÑ„ÇãÁõÆÁöÑ„Å®„Åó„Å¶„ÄÅË™§„Å£„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„ÅØÊ¨°„ÅÆ„ÅÜ„Å°„Å©„Çå„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["Ôºà‰ºöÁ§æ„ÅÆÂ§ñ„ÅÆÔºâÁ§æ‰ºö„Å´ÂøÖË¶Å„Å®„Åï„Çå„ÇãÂΩπÂâ≤„ÇíÂæó„Çã„Åì„Å®„Åß„ÄÅ„Çà„ÇäÂπ∏„Åõ„ÅßÂÖÖÂÆü„Åó„Åü‰∫∫Áîü„ÇíÈÅé„Åî„Åó„Å¶„ÇÇ„Çâ„ÅÜ„Åü„ÇÅ„ÄÇ", "‰ºöÁ§æ„ÅÆÊ•≠Âãô‰ª•Â§ñ„Åã„Çâ„ÄÅ„Åï„Åæ„Åñ„Åæ„Å™Áü•Ë¶ã„ÇÑ„Çπ„Ç≠„É´„ÇíÁç≤Âæó„Åô„ÇãÊ©ü‰ºö„ÅÆ‰∏Ä„Å§„Å´„Åó„Å¶„ÇÇ„Çâ„ÅÑ„Åü„ÅÑ„Åü„ÇÅ„ÄÇ", "‰∫∫‰∫ãË©ï‰æ°„ÇÑ„Éú„Éº„Éä„Çπ„ÅÆË©ï‰æ°„Å´Áõ¥Áµê„Åï„Åõ„ÇãË¶ÅÁ¥†„Å®„Åó„Å¶ËÄÉÊÖÆ„Åô„Çã„Åü„ÇÅ„ÄÇ", "Á§æ‰ºöË™≤È°å„ÇíËµ∑ÁÇπ„Å´„ÄÅÊñ∞„Åü„Å™‰∫ãÊ•≠„ÇíÁîü„ÅøÂá∫„Åô„Åç„Å£„Åã„Åë„Å´„Åó„Å¶„ÇÇ„Çâ„ÅÑ„Åü„ÅÑ„Åü„ÇÅ„ÄÇ"], a: "‰∫∫‰∫ãË©ï‰æ°„ÇÑ„Éú„Éº„Éä„Çπ„ÅÆË©ï‰æ°„Å´Áõ¥Áµê„Åï„Åõ„ÇãË¶ÅÁ¥†„Å®„Åó„Å¶ËÄÉÊÖÆ„Åô„Çã„Åü„ÇÅ„ÄÇ", ex: "Á¨¨‰∏ÄÁæ©ÁöÑ„Å´„ÅØ„ÄÅ‰ºöÁ§æ„ÅÆÂ§ñ„Åß„ÇÇÂøÖË¶Å„Å®„Åï„Çå„ÇãÂΩπÂâ≤„ÇíÂæó„Çã„Åì„Å®„Åß„ÄÅ„Çà„ÇäÂπ∏„Åõ„ÅßÂÖÖ„Åó„Åü‰∫∫Áîü„ÇíÈÅé„Åî„Åó„Å¶„ÇÇ„Çâ„ÅÑ„Åü„ÅÑ„Å®„ÅÑ„ÅÜ„Åì„Å®„Åß„Åô„Åå„ÄÅÁµêÊûúÁöÑ„Å´„Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó„ÇÑ‰∫ãÊ•≠ÂâµÂá∫Á≠â„Åå‰ºöÁ§æ„Å´Ë∑≥„Å≠Ëøî„Å£„Å¶„Åè„Çã„É°„É™„ÉÉ„Éà„ÇÇ„ÅÇ„Çã„Å®ËÄÉ„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åü„Å†„ÄÅ‰æ°ÂÄ§Ë¶≥„ÅØ‰∫∫„Åù„Çå„Åû„Çå„Åß„Åô„Åó„ÄÅ„ÅÇ„Åè„Åæ„Åß„ÇÇ‰ªªÊÑè„Åß„ÅÆÊ¥ªÂãï„Å™„ÅÆ„Åß‰∫∫‰∫ãË©ï‰æ°„ÇÑ„Éú„Éº„Éä„Çπ„Å´Áõ¥Áµê„Åï„Åõ„Çã„Å®„ÅÑ„ÅÜ„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ" },
          { q: "NKC„Ç∞„É´„Éº„Éó„Åß„ÅØ„ÄÅ„ÄåNKC Sustainability Vision 2024„Äç„Å´„Åä„ÅÑ„Å¶„ÄÅESGÈ†òÂüü„Å´„Åä„Åë„ÇãÁõÆ„Å´„ÅØË¶ã„Åà„Å´„Åè„ÅÑ„Åï„Åæ„Åñ„Åæ„Å™Ë¶ÅÁ¥†„Çí„ÄåÂèØË¶ñÂåñ„ÉªÂÆöÈáèÂåñ„Äç„Åô„Çã„Å®„ÅÑ„ÅÜÊñπÈáù„ÇíÁ§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„ÇäÁãô„Å£„Å¶„ÅÑ„ÇãÂäπÊûú„ÅØÊ¨°„ÅÆ„ÅÜ„Å°„Å©„Çå„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["ÈùûË≤°ÂãôÁöÑ„Å™ÊÉÖÂ†±ÂèéÈõÜ„Åå‰∏çË¶Å„Å´„Å™„Çã", "‰ºöÁ§æ„ÅÆÂ£≤‰∏ä„ÇÑÂà©Áõä„ÅåËá™ÂãïÁöÑ„Å´Â¢óÂä†„Åô„Çã", "„Åô„Åπ„Å¶„ÅÆÁ§æ‰ºöË™≤È°å„Çí‰∏ÄÂ∫¶„Å´Ëß£Ê±∫„Åß„Åç„Çã", "‰∫ãÊ•≠Êà¶Áï•„ÅÆÊÑèÊÄùÊ±∫ÂÆö„Å´„Åä„ÅÑ„Å¶Á§æ‰ºöÁöÑ„Å™‰æ°ÂÄ§„ÇíËÄÉÊÖÆ„Åó„ÇÑ„Åô„Åè„Å™„Çã"], a: "‰∫ãÊ•≠Êà¶Áï•„ÅÆÊÑèÊÄùÊ±∫ÂÆö„Å´„Åä„ÅÑ„Å¶Á§æ‰ºöÁöÑ„Å™‰æ°ÂÄ§„ÇíËÄÉÊÖÆ„Åó„ÇÑ„Åô„Åè„Å™„Çã", ex: "ÊäïË≥áÂØæÂäπÊûúÁ≠â„ÅÆ‰∫ãÊ•≠Êà¶Áï•‰∏ä„ÅÆÊÑèÊÄùÊ±∫ÂÆö„Å´„Åä„ÅÑ„Å¶„ÄÅ„ÄåÁí∞Â¢ÉË≤†Ëç∑„Äç„ÄåÁ§æ‰ºöÁöÑ‰æ°ÂÄ§„Äç„ÄåÊ≥ïÁöÑ„É™„Çπ„ÇØ„ÄçÁ≠â„ÅÆ„Åï„Åæ„Åñ„Åæ„Å™ESGÈ†òÂüü„ÅÆË¶ÅÁ¥†„ÇÇ„ÄÅ‰∏Ä‰ΩìÁöÑ„Å™ËÄÉÊÖÆ„Çí„Åó„ÇÑ„Åô„Åè„Å™„ÇãÔºà‰ºöÁ§æ„ÅÆÂà©Áõä„Å®„Çà„Çä„Çà„ÅÑÁ§æ‰ºö„ÅÆ‰∏°Á´ã„ÇíÁõÆÊåá„Åó„ÇÑ„Åô„ÅÑÔºâ„Å®„ÅÑ„ÅÜÂäπÊûú„ÇíÁãô„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ" },
          { q: "NKC„Ç∞„É´„Éº„Éó„ÅÆ„Å®„ÅÇ„Çã‰∫ãÊ•≠ÈÉ®ÈñÄ„Åå„ÄÅÂâç‰æã„ÅÆ„Å™„ÅÑÊñ∞„Åü„Å™‰∫ãÊ•≠„Ç¢„Ç§„Éá„Ç£„Ç¢„ÇíÊ§úË®é„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆÊôÇ„ÄÅNKC„Ç∞„É´„Éº„Éó„ÅÆÊé≤„Åí„Çã„Äå„Éù„Ç∏„ÉÜ„Ç£„ÉñÂøóÂêëÂûã„Ç≥„É≥„Éó„É©„Ç§„Ç¢„É≥„Çπ„Äç„ÅÆÁ≤æÁ•û„Å´ÊúÄ„ÇÇÂêàËá¥„Åô„ÇãË°åÂãï„ÅØ„ÄÅÊ¨°„ÅÆ„ÅÜ„Å°„Å©„Çå„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["Ââç‰æã„Åå„Å™„Åè„É™„Çπ„ÇØ„ÅåÈ´ò„ÅÑ„Åì„Å®„ÅØÊòéÁôΩ„Å™„ÅÆ„Åß„ÄÅÈù¢ÂÄí„Å´„Å™„ÇãÂâç„Å´Ë®àÁîª„Çí‰∏≠Ê≠¢„Åô„Çã„ÄÇ", "„Åæ„Åö„ÅØÂ∞è„Åï„ÅèË©¶„Åó„Å¶„Åø„Å¶„ÄÅÂïèÈ°å„ÅåËµ∑„Åç„Å™„Åë„Çå„Å∞Êú¨Ê†ºÁöÑ„Å´ÈÄ≤„ÇÅ„Çã„ÄÇÁÆ°ÁêÜÈÉ®ÈñÄ„Å´„ÅØÂæå„Åã„ÇâÂ†±Âëä„Åô„Çã„ÄÇ", "Èñ¢ÈÄ£ÈÉ®ÁΩ≤„ÇíÊó©Êúü„Å´Â∑ª„ÅçËæº„Åø„ÄÅ„É™„Çπ„ÇØ„ÇíÂÆ¢Ë¶≥ÁöÑ„Å´Ë©ï‰æ°„Åó„Åü‰∏ä„Åß„ÄÅ„Å©„ÅÜ„Åô„Çå„Å∞ÊåëÊà¶„ÇíÂÆüÁèæ„Åß„Åç„Çã„Åã„ÇíÂª∫Ë®≠ÁöÑ„Å´Ë≠∞Ë´ñ„Åô„Çã„ÄÇ", "ÁµåÂñ∂Èô£„Å´„É™„Çπ„ÇØ„ÅÆÂ§ß„Åç„Åï„ÇíÂº∑Ë™ø„Åó„Å¶Ë™¨Êòé„Åó„ÄÅ‰∫ãÊ•≠„ÇíÈÄ≤„ÇÅ„Çã„Åã„Å©„ÅÜ„Åã„ÅÆÂà§Êñ≠„Çí„Åô„Åπ„Å¶Âßî„Å≠„Çã„ÄÇ"], a: "Èñ¢ÈÄ£ÈÉ®ÁΩ≤„ÇíÊó©Êúü„Å´Â∑ª„ÅçËæº„Åø„ÄÅ„É™„Çπ„ÇØ„ÇíÂÆ¢Ë¶≥ÁöÑ„Å´Ë©ï‰æ°„Åó„Åü‰∏ä„Åß„ÄÅ„Å©„ÅÜ„Åô„Çå„Å∞ÊåëÊà¶„ÇíÂÆüÁèæ„Åß„Åç„Çã„Åã„ÇíÂª∫Ë®≠ÁöÑ„Å´Ë≠∞Ë´ñ„Åô„Çã„ÄÇ", ex: "„Äå„Éù„Ç∏„ÉÜ„Ç£„ÉñÂøóÂêëÂûã„Ç≥„É≥„Éó„É©„Ç§„Ç¢„É≥„Çπ„Äç„Åß„ÅØ„ÄÅ„É™„Çπ„ÇØ„Åã„Çâ„ÄåÁõÆ„ÇíËÉå„Åë„Åö„ÄÅÂêë„ÅçÂêà„ÅÑ„ÄÅÂÖãÊúç„Åô„Çã„Åì„Å®„Åß„ÄÅ„ÉØ„ÇØ„ÉØ„ÇØ„Åô„ÇãÊú™Êù•„ÇíËá™ÂàÜ„Åü„Å°„ÅÆÊâã„ÅßÂàá„ÇäÊãì„ÅÑ„Å¶„ÅÑ„Åè„Äç„Åì„Å®„ÇíÁõÆÊåá„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÈÅ∏ÊäûËÇ¢C„ÅØ„ÄÅ„É™„Çπ„ÇØ„ÇíÈÅéÂâ∞Ë©ï‰æ°„Åó„Å¶ËêéÁ∏Æ„Åô„Çã„Åì„Å®„Å™„Åè„ÄÅÁ§æÂì°‰∏Ä‰∫∫„Å≤„Å®„Çä„Åå„ÄåÁµåÂñ∂ËÄÖÁõÆÁ∑ö„Äç„ÇíÊåÅ„Å£„Åü„ÅÜ„Åà„Åß„Äå„É™„Çπ„ÇØ„Çí„ÉÅ„É£„É≥„Çπ„Å´„ÄçÂ§â„Åà„Çà„ÅÜ„Å®„Åô„ÇãÂÆüË∑µÁöÑ„Å™Ë°åÂãï„Åß„Åô„ÄÇ" },
          { q: "NKC„Ç∞„É´„Éº„Éó„ÅåÂ§ßÈò™Â∫úÔºàÊó•Êú¨ÔºâÁ≠â„ÅÆË°åÊîøËá™Ê≤ª‰Ωì„Å®ÈÄ£Êê∫ÂçîÂÆö„ÇíÁ∑†Áµê„Åó„Å¶„ÅÑ„Çã‰∏ª„Å™ÁõÆÁöÑ„Å®„Åó„Å¶Ë™§„Å£„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„ÅØ„ÄÅÊ¨°„ÅÆ„ÅÜ„Å°„Å©„Çå„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["Á§æ‰ºöÁöÑ„Å™‰ø°È†ºÊÄß„ÇíÈ´ò„ÇÅ„Çã„Åì„Å®„Å´„Çà„Çã‰ºÅÊ•≠„Éñ„É©„É≥„Éâ„Éª‰ºÅÊ•≠‰æ°ÂÄ§„ÅÆÂêë‰∏ä", "NKC„Ç∞„É´„Éº„Éó„ÇíËÇ≤„Çì„Åß„Åè„Çå„ÅüÂú∞ÂüüÁ§æ‰ºö„Å∏„ÅÆÊÅ©Ëøî„Åó", "Ë°åÊîø„Å®Ê∞ëÈñì‰ºÅÊ•≠„ÅÆ„Åù„Çå„Åû„Çå„ÅÆÂº∑„Åø„ÇíÊ¥ª„Åã„Åó„ÅüÁ§æ‰ºöË™≤È°åËß£Ê±∫„ÅÆÂä†ÈÄü", "ÂÖ¨ÁöÑ„Å™Ë£úÂä©ÈáëÁ≠â„ÇíÂèó„Åë„ÇÑ„Åô„Åè„Åô„Çã„Åì„Å®„Åß„ÅÆÁü≠ÊúüÁöÑ„Å™ÂèéÁõäÊÄß„ÅÆÂêë‰∏ä"], a: "ÂÖ¨ÁöÑ„Å™Ë£úÂä©ÈáëÁ≠â„ÇíÂèó„Åë„ÇÑ„Åô„Åè„Åô„Çã„Åì„Å®„Åß„ÅÆÁü≠ÊúüÁöÑ„Å™ÂèéÁõäÊÄß„ÅÆÂêë‰∏ä", ex: "2022Âπ¥3Êúà„Å´‰∏≠Ë•øÈáëÂ±ûÂ∑•Ê•≠„à±„Å®Â§ßÈò™Â∫ú„Å®„ÅÆÈñì„ÅßÁ∑†Áµê„Åó„ÅüÂåÖÊã¨ÈÄ£Êê∫ÂçîÂÆöÁ≠â„Å´Âü∫„Å•„Åç„ÄÅAÔΩûC„ÅÆ„Çà„ÅÜ„Å™ÂäπÊûú„ÇíÁãô„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇË£úÂä©ÈáëÁ≠â„ÅÆÁç≤Âæó„ÅßÊúâÂà©„Å´ÂÉç„ÅèÂèØËÉΩÊÄß„ÇÇ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„Åì„Çå„Çí‰∏ª„Åü„ÇãÁõÆÁöÑ„Å®„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇËøëÊôÇ„Åß„ÅØ„ÄÅÂ§ßÈò™Â∫ú„Å®ÈÄ£Êê∫ÂçîÂÆö„ÇíÁ∑†Áµê„Åó„Å¶„ÅÑ„Çã‰ªñ„ÅÆÊ∞ëÈñì‰ºÅÊ•≠„Å®„ÅÆ‰∫ãÊ•≠„Åß„ÅÆ„Ç≥„É©„Éú„É¨„Éº„Ç∑„Éß„É≥„ÅÆÊ§úË®é„ÇÇÂßã„Åæ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ" }
        ]
      },
      en: {
        instructionTitle: "Rules of the Quest",
        instructions: ["- You will be asked 5 questions about sustainability.", "- Answer 4 or more correctly to defeat the boss!", "- Only your first attempt on each stage will be recorded.", "- Good luck!"],
        instructionOk: "Got it",
        title: "Stage 3: Governance",
        employeeIdPlaceholder: "Enter 5-digit Employee ID",
        companySelectDefault: "Select your company",
        startButton: "Challenge",
        msgEnterId: "Please enter your Company and Employee ID",
        msgCheckingId: "Checking eligibility...",
        msgIdNotFound: "Stage 1 record not found. Please check your Company and Employee ID.",
        msgCheckError: "Verification error. Please try again later.",
        theme: "Theme: Governance",
        progress: (q, t) => `Q ${q}/${t}`,
        bossHp: "Boss HP",
        resultWinTitle: "Victory!",
        resultWinMsg: "Stage Clear! Your awareness of governance has increased!",
        resultLoseTitle: "Game Over",
        resultLoseMsg: "The dragon's wisdom was profound...",
        submitting: "Submitting results...",
        submitSuccess: "Results submitted!",
        submitError: "Error: Could not submit results.",
        recordedFalse: "Thanks for playing! Only your first result is recorded.",
        restartButton: "Back to Title",
        correct: "Correct!",
        incorrect: "Incorrect...",
        nextButton: "Next",
        quiz: [
          { q: "Which of the following is an incorrect benefit for a company engaging in ESG (Environmental, Social, and Governance)?", o: ["Gaining a competitive advantage by being chosen for factors other than quality and price.", "Achieving both business growth and a better society through new, socially-driven business creation.", "Maximizing short-term profits by making it easier to obtain subsidies.", "Gaining an advantage in recruiting talented personnel and in fundraising."], a: "Maximizing short-term profits by making it easier to obtain subsidies.", ex: "ESG initiatives aim for long-term corporate value enhancement and sustainable growth. Maximizing short-term profit as the sole objective is contrary to the original purpose of ESG. The NKC Group's 'NKC Sustainability Vision 2024' also aims to integrate sustainability strategy with business strategy to create a new 'growth strategy'." },
          { q: "Which of the following is an incorrect reason for the NKC Group to encourage employees to actively participate in social contribution activities?", o: ["To help them lead happier, more fulfilling lives by gaining roles needed by society (outside the company).", "To provide them with an opportunity to acquire diverse knowledge and skills from outside their regular work.", "To consider it as a direct factor in performance reviews and bonus evaluations.", "To inspire them to create new businesses based on social issues."], a: "To consider it as a direct factor in performance reviews and bonus evaluations.", ex: "Primarily, we want employees to lead happier lives by finding fulfilling roles outside the company. However, we also believe there are benefits for the company, such as skill enhancement and business creation. Since values differ and participation is voluntary, it is not directly linked to performance reviews or bonuses." },
          { q: "In 'NKC Sustainability Vision 2024,' the NKC Group aims to 'visualize and quantify' various intangible ESG factors. What is the intended effect of this policy?", o: ["It eliminates the need to collect non-financial information.", "It automatically increases company sales and profits.", "It can solve all social issues at once.", "It makes it easier to consider social value in business strategy decisions."], a: "It makes it easier to consider social value in business strategy decisions.", ex: "The goal is to make it easier to integrally consider various ESG factors such as 'environmental impact,' 'social value,' and 'legal risks' in business strategy decisions like return on investment, aiming for a balance between company profit and a better society." },
          { q: "A business unit within the NKC Group is considering an unprecedented new business idea. Which action best aligns with the NKC Group's 'Positive-Oriented Compliance' spirit?", o: ["Cancel the plan before it becomes troublesome, as it is clearly high-risk with no precedent.", "Try it on a small scale first, and if no problems arise, proceed fully, reporting to management later.", "Involve relevant departments early, objectively assess the risks, and constructively discuss how to make the challenge a reality.", "Emphasize the magnitude of the risks to management and leave the entire decision of whether to proceed to them."], a: "Involve relevant departments early, objectively assess the risks, and constructively discuss how to make the challenge a reality.", ex: "'Positive-Oriented Compliance' aims to 'not turn away from risks, but face them and overcome them to build an exciting future with our own hands.' Option C is a practical action that avoids being paralyzed by overestimating risks and instead seeks to turn 'risks into opportunities' with each employee having a 'manager's perspective'." },
          { q: "Which of the following is an incorrect primary purpose for the NKC Group's collaboration agreements with administrative bodies like Osaka Prefecture (Japan)?", o: ["Enhancing corporate brand and value by increasing social credibility.", "Giving back to the local community that has nurtured the NKC Group.", "Accelerating the resolution of social issues by leveraging the respective strengths of government and private companies.", "Improving short-term profitability by making it easier to receive public subsidies."], a: "Improving short-term profitability by making it easier to receive public subsidies.", ex: "Based on the comprehensive collaboration agreement signed between Nakanishi Metal Works Co., Ltd. and Osaka Prefecture in March 2022, we aim for effects A through C. While it may be advantageous for obtaining subsidies, this is not the primary goal. Recently, we have also begun exploring business collaborations with other private companies that have agreements with Osaka Prefecture." }
        ]
      },
      zh: {
        instructionTitle: "ÂÜíÈô©È°ªÁü•",
        instructions: ["„ÉªÂ∞ÜÊèêÂá∫5‰∏™ÂÖ≥‰∫éÂèØÊåÅÁª≠ÊÄßÁöÑÈóÆÈ¢ò„ÄÇ", "„ÉªÊ≠£Á°ÆÂõûÁ≠î4‰∏™‰ª•‰∏äÈóÆÈ¢òÂç≥ÂèØÂáªÊïóÂ§¥ÁõÆÔºÅ", "„ÉªÊØè‰∏™ÂÖ≥Âç°Âè™ÊúâÁ¨¨‰∏ÄÊ¨°ÊåëÊàòÁöÑÁªìÊûú‰ºöË¢´ËÆ∞ÂΩï„ÄÇ", "„ÉªÁ•ù‰Ω†Â•ΩËøêÔºÅ"],
        instructionOk: "Áü•ÈÅì‰∫Ü",
        title: "Á¨¨‰∏âÂÖ≥ÔºöÊ≤ªÁêÜ",
        employeeIdPlaceholder: "ËæìÂÖ•ÂëòÂ∑•ÁºñÂè∑(5‰ΩçÂçäËßíÊï∞Â≠ó)",
        companySelectDefault: "ËØ∑ÈÄâÊã©ÊâÄÂ±ûÂÖ¨Âè∏",
        startButton: "ÊåëÊàò",
        msgEnterId: "ËØ∑ËæìÂÖ•ÊâÄÂ±ûÂÖ¨Âè∏ÂíåÂëòÂ∑•ÁºñÂè∑",
        msgCheckingId: "Ê≠£Âú®Á°ÆËÆ§ÊåëÊàòËµÑÊ†º...",
        msgIdNotFound: "Êú™ÊâæÂà∞Á¨¨‰∏ÄÂÖ≥ÁöÑËÆ∞ÂΩï„ÄÇËØ∑Ê£ÄÊü•ÂÖ¨Âè∏ÂêçÁß∞ÂíåÂëòÂ∑•ÁºñÂè∑„ÄÇ",
        msgCheckError: "Á°ÆËÆ§Âá∫Èîô„ÄÇËØ∑Á®çÂêéÂÜçËØï„ÄÇ",
        theme: "‰∏ªÈ¢òÔºöÊ≤ªÁêÜ",
        progress: (q, t) => `Á¨¨${q}/${t}È¢ò`,
        bossHp: "Â§¥ÁõÆ HP",
        resultWinTitle: "ËÉúÂà©ÔºÅ",
        resultWinMsg: "ÂÖ≥Âç°ÂÆåÊàêÔºÅÂä†Ê∑±‰∫ÜÂØπÊ≤ªÁêÜÁöÑËÆ§ËØÜÔºÅ",
        resultLoseTitle: "Ê∏∏ÊàèÁªìÊùü",
        resultLoseMsg: "ÈæôÁöÑÊô∫ÊÖßÊòØÊ∑±Â••ÁöÑ‚Ä¶",
        submitting: "Ê≠£Âú®ÂèëÈÄÅÁªìÊûú...",
        submitSuccess: "ÁªìÊûúÂ∑≤ÂèëÈÄÅÔºÅ",
        submitError: "ÈîôËØØÔºöÊó†Ê≥ïÂèëÈÄÅÁªìÊûú„ÄÇ",
        recordedFalse: "ÊÑüË∞¢ÊÇ®ÁöÑÂèÇ‰∏éÔºÅÂè™ÊúâÂàùÊ¨°ÊåëÊàòÁªìÊûú‰ºöË¢´ËÆ∞ÂΩï„ÄÇ",
        restartButton: "ËøîÂõûÊ†áÈ¢ò",
        correct: "ÂõûÁ≠îÊ≠£Á°ÆÔºÅ",
        incorrect: "ÂõûÁ≠îÈîôËØØ...",
        nextButton: "‰∏ã‰∏Ä‰∏™",
        quiz: [
          { q: "‰ºÅ‰∏öËá¥Âäõ‰∫éESGÔºàÁéØÂ¢É„ÄÅÁ§æ‰ºöÂíåÂÖ¨Âè∏Ê≤ªÁêÜÔºâÊâÄËÉΩËé∑ÂæóÁöÑÁõäÂ§Ñ‰∏≠Ôºå‰ª•‰∏ãÂì™È°πÊòØÈîôËØØÁöÑÔºü", o: ["Ëé∑ÂæóÈô§Ë¥®ÈáèÂíå‰ª∑Ê†ºÂ§ñÔºå‰πüËÉΩË¢´È°æÂÆ¢ÂíåÂ∏ÇÂú∫ÈÄâÊã©ÁöÑ‰∏öÂä°Á´û‰∫âÂäõ„ÄÇ", "ÈÄöËøáÊ∫ê‰∫éÁ§æ‰ºöËØæÈ¢òÁöÑÊñ∞‰∏öÂä°ÂàõÈÄ†Á≠âÔºåÂÆûÁé∞‰∏öÂä°Â¢ûÈïø‰∏éÊõ¥ÁæéÂ•ΩÁéØÂ¢ÉÂíåÁ§æ‰ºöÁöÑÂèåËµ¢„ÄÇ", "ÈÄöËøáÊõ¥ÂÆπÊòìËé∑ÂæóË°•Âä©ÈáëÁ≠âÔºåÂÆûÁé∞Áü≠ÊúüÂà©ÁõäÊúÄÂ§ßÂåñ„ÄÇ", "Âú®ÊãõËÅò‰ºòÁßÄ‰∫∫ÊâçÂíåËµÑÈáëÁ≠πÊé™ÊñπÈù¢Â§Ñ‰∫éÊúâÂà©Âú∞‰Ωç„ÄÇ"], a: "ÈÄöËøáÊõ¥ÂÆπÊòìËé∑ÂæóË°•Âä©ÈáëÁ≠âÔºåÂÆûÁé∞Áü≠ÊúüÂà©ÁõäÊúÄÂ§ßÂåñ„ÄÇ", ex: "Ëá¥Âäõ‰∫éESGÊòØ‰∏∫‰∫ÜÊèêÂçáÈïøÊúü‰ºÅ‰∏ö‰ª∑ÂÄºÂíåÂÆûÁé∞ÂèØÊåÅÁª≠ÂèëÂ±ï„ÄÇÂ∞ÜÁü≠ÊúüÂà©ÁõäÊúÄÂ§ßÂåñ‰Ωú‰∏∫ÂîØ‰∏ÄÁõÆÁöÑÔºå‰∏éESGÁöÑÂàùË°∑‰∏çÁ¨¶„ÄÇNKCÈõÜÂõ¢Âú®„ÄäNKCÂèØÊåÅÁª≠ÂèëÂ±ïÊÑøÊôØ2024„Äã‰∏≠‰πüÊèêÂá∫ÔºåÊó®Âú®Â∞ÜÂèØÊåÅÁª≠ÂèëÂ±ïÊàòÁï•‰∏é‰∏öÂä°ÊàòÁï•Áõ∏ËûçÂêàÔºåÂΩ¢ÊàêÊñ∞ÁöÑ‚ÄúÂ¢ûÈïøÊàòÁï•‚Äù„ÄÇ" },
          { q: "NKCÈõÜÂõ¢ÈºìÂä±ÂëòÂ∑•ÁßØÊûÅÂèÇ‰∏éÁ§æ‰ºöË¥°ÁåÆÊ¥ªÂä®ÁöÑÁõÆÁöÑ‰∏≠Ôºå‰ª•‰∏ãÂì™È°πÊòØÈîôËØØÁöÑÔºü", o: ["ÈÄöËøáÂú®ÂÖ¨Âè∏Â§ñÈÉ®Ëé∑ÂæóÁ§æ‰ºöÊâÄÈúÄÁöÑËßíËâ≤ÔºåËÆ©‰ªñ‰ª¨Â∫¶ËøáÊõ¥Âπ∏Á¶è„ÄÅÊõ¥ÂÖÖÂÆûÁöÑ‰∫∫Áîü„ÄÇ", "Â∏åÊúõËøôËÉΩÊàê‰∏∫‰ªñ‰ª¨‰ªéÂÖ¨Âè∏‰∏öÂä°‰πãÂ§ñËé∑ÂæóÂêÑÁßçÁü•ËØÜÂíåÊäÄËÉΩÁöÑÊú∫‰ºö‰πã‰∏Ä„ÄÇ", "‰Ωú‰∏∫Áõ¥Êé•ÂÖ≥Á≥ªÂà∞‰∫∫‰∫ãËØÑ‰ª∑ÂíåÂ•ñÈáëËØÑ‰º∞ÁöÑÂõ†Á¥†Âä†‰ª•ËÄÉËôë„ÄÇ", "Â∏åÊúõËøôËÉΩÊàê‰∏∫‰ªñ‰ª¨‰ª•Á§æ‰ºöËØæÈ¢ò‰∏∫Ëµ∑ÁÇπÔºåÂàõÈÄ†Êñ∞‰∏öÂä°ÁöÑÂ•ëÊú∫„ÄÇ"], a: "‰Ωú‰∏∫Áõ¥Êé•ÂÖ≥Á≥ªÂà∞‰∫∫‰∫ãËØÑ‰ª∑ÂíåÂ•ñÈáëËØÑ‰º∞ÁöÑÂõ†Á¥†Âä†‰ª•ËÄÉËôë„ÄÇ", ex: "È¶ñË¶ÅÁõÆÁöÑÊòØÂ∏åÊúõÂëòÂ∑•ÈÄöËøáÂú®ÂÖ¨Âè∏Â§ñÈÉ®Ëé∑ÂæóË¢´ÈúÄË¶ÅÁöÑËßíËâ≤Ôºå‰ªéËÄåÂ∫¶ËøáÊõ¥Âπ∏Á¶èÂÖÖÂÆûÁöÑ‰∫∫Áîü„ÄÇ‰ΩÜÊàë‰ª¨ËÆ§‰∏∫ÔºåËøôÊúÄÁªà‰πü‰ºö‰∏∫ÂÖ¨Âè∏Â∏¶Êù•ÊäÄËÉΩÊèêÂçáÂíå‰∏öÂä°ÂàõÈÄ†Á≠âÂ•ΩÂ§Ñ„ÄÇ‰∏çËøáÔºå‰ª∑ÂÄºËßÇÂõ†‰∫∫ËÄåÂºÇÔºåËøôÁ∫ØÂ±ûËá™ÊÑøÊ¥ªÂä®ÔºåÂõ†Ê≠§‰∏ç‰ºö‰∏é‰∫∫‰∫ãËØÑ‰ª∑ÊàñÂ•ñÈáëÁõ¥Êé•ÊåÇÈí©„ÄÇ" },
          { q: "NKCÈõÜÂõ¢Âú®„ÄäNKCÂèØÊåÅÁª≠ÂèëÂ±ïÊÑøÊôØ2024„Äã‰∏≠ÊèêÂá∫‰∫ÜÂ∞ÜESGÈ¢ÜÂüü‰∏≠Èöæ‰ª•ÁúãËßÅÁöÑÂêÑÁßçË¶ÅÁ¥†‚ÄúÂèØËßÜÂåñ„ÄÅÂÆöÈáèÂåñ‚ÄùÁöÑÊñπÈíà„ÄÇÊ≠§‰∏æÊó®Âú®ËææÂà∞‰ª•‰∏ãÂì™ÁßçÊïàÊûúÔºü", o: ["‰∏çÂÜçÈúÄË¶ÅÊî∂ÈõÜÈùûË¥¢Âä°‰ø°ÊÅØ", "ÂÖ¨Âè∏ÈîÄÂîÆÈ¢ùÂíåÂà©Ê∂¶Â∞ÜËá™Âä®Â¢ûÈïø", "ËÉΩÂ§ü‰∏ÄÊ¨°ÊÄßËß£ÂÜ≥ÊâÄÊúâÁ§æ‰ºöÈóÆÈ¢ò", "Âú®‰∏öÂä°ÊàòÁï•ÂÜ≥Á≠ñ‰∏≠Êõ¥ÂÆπÊòìËÄÉËôëÁ§æ‰ºö‰ª∑ÂÄº"], a: "Âú®‰∏öÂä°ÊàòÁï•ÂÜ≥Á≠ñ‰∏≠Êõ¥ÂÆπÊòìËÄÉËôëÁ§æ‰ºö‰ª∑ÂÄº", ex: "Ê≠§‰∏æÊó®Âú®‰Ωø‚ÄúÁéØÂ¢ÉË¥üËç∑‚Äù„ÄÅ‚ÄúÁ§æ‰ºö‰ª∑ÂÄº‚Äù„ÄÅ‚ÄúÊ≥ïÂæãÈ£éÈô©‚ÄùÁ≠âÂêÑÁßçESGÈ¢ÜÂüüÁöÑË¶ÅÁ¥†ÔºåÂú®ÊäïËµÑÂõûÊä•ÁéáÁ≠â‰∏öÂä°ÊàòÁï•ÂÜ≥Á≠ñ‰∏≠Êõ¥ÂÆπÊòìË¢´ÁªºÂêàËÄÉËôëÔºå‰ªéËÄåÂäõÊ±ÇÂÆûÁé∞ÂÖ¨Âè∏Âà©Áõä‰∏éÊõ¥ÁæéÂ•ΩÁ§æ‰ºöÁöÑÂèåËµ¢„ÄÇ" },
          { q: "NKCÈõÜÂõ¢ÁöÑÊüê‰∏™‰∏öÂä°ÈÉ®Èó®Ê≠£Âú®Êé¢ËÆ®‰∏Ä‰∏™Âè≤Êó†Ââç‰æãÁöÑÊñ∞‰∏öÂä°ÊûÑÊÉ≥„ÄÇÊ≠§Êó∂ÔºåÊúÄÁ¨¶ÂêàNKCÈõÜÂõ¢ÊâÄÂÄ°ÂØºÁöÑ‚ÄúÁßØÊûÅÂØºÂêëÂûãÂêàËßÑ‚ÄùÁ≤æÁ•ûÁöÑË°åÂä®ÊòØ‰ª•‰∏ãÂì™‰∏ÄÈ°πÔºü", o: ["Âõ†‰∏∫Ê≤°ÊúâÂÖà‰æã‰∏îÈ£éÈô©ÊòéÊòæÂæàÈ´òÔºåÊâÄ‰ª•Âú®ÂèòÂæóÈ∫ªÁÉ¶‰πãÂâç‰∏≠Ê≠¢ËÆ°Âàí„ÄÇ", "ÂÖàËøõË°åÂ∞èËßÑÊ®°Â∞ùËØïÔºåÂ¶ÇÊûúÊ≤°ÊúâÈóÆÈ¢òÂÜçÊ≠£ÂºèÊé®Ëøõ„ÄÇ‰∫ãÂêéÂÜçÂêëÁÆ°ÁêÜÈÉ®Èó®Êä•Âëä„ÄÇ", "Â∞ΩÊó©ËÆ©Áõ∏ÂÖ≥ÈÉ®Èó®ÂèÇ‰∏éËøõÊù•ÔºåÂú®ÂÆ¢ËßÇËØÑ‰º∞È£éÈô©ÁöÑÂü∫Á°Ä‰∏äÔºåÂª∫ËÆæÊÄßÂú∞ËÆ®ËÆ∫Â¶Ç‰ΩïÊâçËÉΩÂÆûÁé∞Ëøô‰∏ÄÊåëÊàò„ÄÇ", "ÂêëÁªèËê•Â±ÇÂº∫Ë∞ÉÈ£éÈô©ÁöÑÂ∑®Â§ßÔºåÂπ∂Â∞ÜÊòØÂê¶Êé®Ëøõ‰∏öÂä°ÁöÑÂà§Êñ≠ÂÖ®ÈÉ®ÂßîÊâòÁªô‰ªñ‰ª¨„ÄÇ"], a: "Â∞ΩÊó©ËÆ©Áõ∏ÂÖ≥ÈÉ®Èó®ÂèÇ‰∏éËøõÊù•ÔºåÂú®ÂÆ¢ËßÇËØÑ‰º∞È£éÈô©ÁöÑÂü∫Á°Ä‰∏äÔºåÂª∫ËÆæÊÄßÂú∞ËÆ®ËÆ∫Â¶Ç‰ΩïÊâçËÉΩÂÆûÁé∞Ëøô‰∏ÄÊåëÊàò„ÄÇ", ex: "‚ÄúÁßØÊûÅÂØºÂêëÂûãÂêàËßÑ‚ÄùÊó®Âú®‚Äú‰∏çÂõûÈÅøÈ£éÈô©ÔºåËÄåÊòØÁõ¥Èù¢Âπ∂ÂÖãÊúçÂÆÉÔºåÁî®Êàë‰ª¨Ëá™Â∑±ÁöÑÂèåÊâãÂºÄÂàõÊøÄÂä®‰∫∫ÂøÉÁöÑÊú™Êù•‚Äù„ÄÇÈÄâÈ°πCÊòØ‰∏ÄÁßçÂä°ÂÆûÁöÑË°åÂä®ÔºåÂÆÉ‰∏çÂõ†ËøáÈ´òËØÑ‰º∞È£éÈô©ËÄåÈÄÄÁº©ÔºåËÄåÊòØËÆ©ÊØè‰ΩçÂëòÂ∑•ÈÉΩÂÖ∑Â§á‚ÄúÁªèËê•ËÄÖËßÜËßí‚ÄùÔºåÂä™ÂäõÂ∞Ü‚ÄúÈ£éÈô©Âèò‰∏∫Êú∫ÈÅá‚Äù„ÄÇ" },
          { q: "NKCÈõÜÂõ¢‰∏éÂ§ßÈò™Â∫úÔºàÊó•Êú¨ÔºâÁ≠âË°åÊîøËá™Ê≤ª‰ΩìÁ≠æËÆ¢Âêà‰ΩúÂçèËÆÆÁöÑ‰∏ªË¶ÅÁõÆÁöÑ‰∏≠Ôºå‰ª•‰∏ãÂì™È°πÊòØÈîôËØØÁöÑÔºü", o: ["ÈÄöËøáÊèêÈ´òÁ§æ‰ºö‰ø°Ë™âÊù•ÊèêÂçá‰ºÅ‰∏öÂìÅÁâåÂíå‰ºÅ‰∏ö‰ª∑ÂÄº", "ÂõûÊä•ÂüπËÇ≤‰∫ÜNKCÈõÜÂõ¢ÁöÑÂú∞Âå∫Á§æ‰ºö", "ÂèëÊå•Ë°åÊîøÂíåÊ∞ëËê•‰ºÅ‰∏öÂêÑËá™ÁöÑ‰ºòÂäøÔºåÂä†ÈÄüËß£ÂÜ≥Á§æ‰ºöËØæÈ¢ò", "ÈÄöËøáÊõ¥ÂÆπÊòìËé∑ÂæóÂÖ¨ÂÖ±Ë°•Âä©ÈáëÁ≠âÊù•ÊèêÈ´òÁü≠ÊúüÁõàÂà©ËÉΩÂäõ"], a: "ÈÄöËøáÊõ¥ÂÆπÊòìËé∑ÂæóÂÖ¨ÂÖ±Ë°•Âä©ÈáëÁ≠âÊù•ÊèêÈ´òÁü≠ÊúüÁõàÂà©ËÉΩÂäõ", ex: "Âü∫‰∫é2022Âπ¥3Êúà‰∏≠Ë•øÈáëÂ±ûÂ∑•‰∏öÊ†™Âºè‰ºöÁ§æ‰∏éÂ§ßÈò™Â∫úÁ≠æËÆ¢ÁöÑÂÖ®Èù¢Âêà‰ΩúÂçèËÆÆÁ≠âÔºåÊàë‰ª¨Êó®Âú®ÂÆûÁé∞AËá≥CÁöÑÊïàÊûú„ÄÇËôΩÁÑ∂ËøôÂèØËÉΩÊúâÂä©‰∫éËé∑ÂæóË°•Âä©ÈáëÁ≠âÔºå‰ΩÜËøôÂπ∂Èùû‰∏ªË¶ÅÁõÆÁöÑ„ÄÇËøëÊúüÔºåÊàë‰ª¨‰πüÂºÄÂßãÊé¢ËÆ®‰∏éÂÖ∂‰ªñÂ∑≤ÂêåÂ§ßÈò™Â∫úÁ≠æËÆ¢Âêà‰ΩúÂçèËÆÆÁöÑÊ∞ëËê•‰ºÅ‰∏öËøõË°å‰∏öÂä°Âêà‰Ωú„ÄÇ" }
        ]
      }
    };
    const companyList = {
      ja: ["Êú¨Á§æ/Â§©Ê∫ÄÂú∞Âå∫", "Ê≤ªÂ∑•ÂÖ∑Â∑•Â†¥", "Á•ûÊà∏Â∑•Â†¥", "Â§ßÈò™Â∑•Â†¥", "ÂêçÂºµÂ∑•Â†¥", "‰∏âÈáçÂ∑•Â†¥", "ÊªãË≥ÄÂ∑•Â†¥", "Ê≤≥ÂÜÖÂ∑•Â†¥", "Ê†™Âºè‰ºöÁ§æNKC NASSH", "Ê†™Âºè‰ºöÁ§æÈ†àÁî∞ÂïÜ‰∫ã", "ÂØåÂ£´„Éõ„Éº„Éã„É≥„Ç∞Â∑•Ê•≠Ê†™Âºè‰ºöÁ§æ", "‰∏≠Ë•øËààÁî£Ê†™Âºè‰ºöÁ§æ", "„Ç∑„Éº„Éª„ÉÜ„Ç£„Éª„Éû„Ç∑„É≥Ê†™Âºè‰ºöÁ§æ", "„Ç§„Éº„Ç∞„É≠„Éº„Éê„É¨„ÉÉ„Ç∏Ê†™Âºè‰ºöÁ§æ", "NKC„Å™„Åå„ÅÑ„Ç∞„É™„Éº„É≥„Éë„ÉØ„ÉºÊ†™Âºè‰ºöÁ§æ", "NMC", "NSC", "NWC", "NPC", "NAI", "NCP", "NDC", "„Åù„ÅÆ‰ªñ"],
      en: ["HQ/Tenma Area", "Jig & Tool Factory", "Kobe Plant", "Osaka Plant", "Nabari Plant", "Mie Plant", "Shiga Plant", "Kawachi Plant", "NKC NASSH Inc.", "Suda Corporation", "Fuji Honing Industrial Co., Ltd.", "Nakanishi Kosan Co., Ltd.", "C.T. Machine Co., Ltd.", "e-Globaledge Corporation", "NKC Nagai Green Power Co., Ltd.", "NMC", "NSC", "NWC", "NPC", "NAI", "NCP", "NDC", "Other"],
      zh: ["ÊÄªÂÖ¨Âè∏/Â§©Êª°Âú∞Âå∫", "Ê≤ªÂ∑•ÂÖ∑Â∑•Â†¥", "Á•ûÊà∑Â∑•ÂéÇ", "Â§ßÈò™Â∑•ÂéÇ", "ÂêçÂº†Â∑•ÂéÇ", "‰∏âÈáçÂ∑•ÂéÇ", "ÊªãË¥∫Â∑•ÂéÇ", "Ê≤≥ÂÜÖÂ∑•ÂéÇ", "Ê†™Âºè‰ºöÁ§æNKC NASSH", "Ê†™Âºè‰ºöÁ§æÈ°ªÁî∞ÂïÜ‰∫ã", "ÂØåÂ£´Áè©Á£®Â∑•‰∏öÊ†™Âºè‰ºöÁ§æ", "‰∏≠Ë•øÂÖ¥‰∫ßÊ†™Âºè‰ºöÁ§æ", "C.T. MachineÊ†™Âºè‰ºöÁ§æ", "e-GlobaledgeÊ†™Âºè‰ºöÁ§æ", "NKCÈïø‰∫ïÁªøËâ≤ÁîµÂäõÊ†™Âºè‰ºöÁ§æ", "NMC", "NSC", "NWC", "NPC", "NAI", "NCP", "NDC", "ÂÖ∂‰ªñ"]
    };
    
    const titleScreen = document.getElementById('title-screen');
    const languageScreen = document.getElementById('language-screen');
    const instructionScreen = document.getElementById('instruction-screen');
    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const bossContainer = document.getElementById('boss-container');
    const employeeIdInput = document.getElementById('employeeIdInput');
    const companySelect = document.getElementById('companySelect');
    const bgm = document.getElementById('bgm');
    const correctSound = document.getElementById('correct-sound');
    const startButton = document.getElementById('start-button');
    const explanationModal = document.getElementById('explanation-modal');
    const nextQuestionButton = document.getElementById('next-question-button');
    const openingVideoContainer = document.getElementById('opening-video-container');
    const gameVideoContainer = document.getElementById('game-video-container');

    let currentLang = 'ja';
    let timerInterval, startTime, correctCount, isGameInProgress = false, audioStarted = false;
    let clickSound, hitSound, damageSound, victorySound, defeatSound;

    function switchScreen(screenName) {
      [titleScreen, languageScreen, instructionScreen, startScreen, quizScreen, resultScreen].forEach(s => s.classList.add('hidden'));
      document.getElementById(`${screenName}-screen`).classList.remove('hidden');
    }
    
    function updateUIText() {
      const t = TEXTS[currentLang];
      document.body.lang = currentLang;
      document.getElementById('instruction-title').textContent = t.instructionTitle;
      document.getElementById('instruction-text').innerHTML = t.instructions.map(line => `<p>${line}</p>`).join('');
      document.getElementById('instruction-ok-button').textContent = t.instructionOk;
      document.getElementById('title-text').textContent = t.title;
      employeeIdInput.placeholder = t.employeeIdPlaceholder;
      document.getElementById('start-button-text').textContent = t.startButton;
      document.getElementById('boss-hp-label').textContent = t.bossHp;
      document.getElementById('restart-button').textContent = t.restartButton;
      document.getElementById('theme-display').textContent = t.theme;
      
      companySelect.innerHTML = `<option value="">${t.companySelectDefault}</option>`;
      companyList[currentLang].forEach(company => {
        companySelect.innerHTML += `<option value="${company}">${company}</option>`;
      });
    }

    function setupAudio() {
      if (audioStarted) return;
      // ‚òÖËøΩÂä†: BGM„ÅÆÈü≥Èáè„Çí70%„Å´Ë®≠ÂÆö
      bgm.volume = 0.7;
      clickSound = () => new Tone.MembraneSynth({ pitchDecay: 0.01, octaves: 3, envelope: { attack: 0.001, decay: 0.3, sustain: 0 } }).toDestination().triggerAttackRelease("C2", "8n");
      hitSound = () => {
        correctSound.currentTime = 0;
        correctSound.play().catch(e => console.error("Correct sound play failed:", e));
      };
      damageSound = () => new Tone.NoiseSynth({ noise: { type: "pink" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.2 } }).toDestination().triggerAttackRelease("8n");
      victorySound = () => { const s = new Tone.Synth().toDestination(), n = Tone.now(); s.triggerAttackRelease("C5", "8n", n); s.triggerAttackRelease("E5", "8n", n + 0.2); s.triggerAttackRelease("G5", "8n", n + 0.4); s.triggerAttackRelease("C6", "4n", n + 0.6) };
      defeatSound = () => { const s = new Tone.Synth().toDestination(), n = Tone.now(); s.triggerAttackRelease("C4", "4n", n); s.triggerAttackRelease("B3", "4n", n + 0.3); s.triggerAttackRelease("A#3", "4n", n + 0.6); s.triggerAttackRelease("A3", "2n", n + 0.9) };
      audioStarted = true;
    }

    function normalizeEmployeeIdForHTML(v) {
      const digits = String(v == null ? "" : v).replace(/[^\d]/g, "");
      return digits.padStart(5, "0");
    }

    async function startGame() {
      if (!employeeIdInput.checkValidity()) {
        employeeIdInput.reportValidity();
        return;
      }
      const company = companySelect.value;
      const employeeId = employeeIdInput.value.trim();
      const msgEl = document.getElementById('msg');
      if (!company || !employeeId) {
        msgEl.textContent = TEXTS[currentLang].msgEnterId;
        return;
      }
      if (isGameInProgress) return;
      isGameInProgress = true;
      startButton.disabled = true;
      msgEl.textContent = TEXTS[currentLang].msgCheckingId;

      const normalizedEmployeeId = normalizeEmployeeIdForHTML(employeeId);

      try {
        const checkUrl = `${GAS_URL}?action=checkEmployeeId&employeeId=${encodeURIComponent(normalizedEmployeeId)}&company=${encodeURIComponent(company)}`;
        const response = await fetch(checkUrl);
        const result = await response.json();

        if (result.exists) {
          msgEl.textContent = "";
          bgm.play().catch(e => console.error("BGM play failed:", e));
          clickSound();
          correctCount = 0;
          document.getElementById('boss-area').classList.remove('hidden');
          bossContainer.className = 'boss-idle';
          updateHpBars(100);
          switchScreen('quiz');
          startTime = Date.now();
          timerInterval = setInterval(() => {
            const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('timer-display').textContent = `${elapsedTime}s`;
          }, 100);
          displayQuestion(0);
        } else {
          msgEl.textContent = TEXTS[currentLang].msgIdNotFound;
        }
      } catch (error) {
        console.error("Error checking employee ID:", error);
        msgEl.textContent = TEXTS[currentLang].msgCheckError;
      } finally {
        isGameInProgress = false;
        startButton.disabled = false;
      }
    }

    function displayQuestion(index) {
      const quizData = TEXTS[currentLang].quiz;
      document.getElementById('progress-display').textContent = TEXTS[currentLang].progress(index + 1, quizData.length);
      const current = quizData[index];
      document.getElementById('question-text').textContent = `Q${index + 1}: ${current.q}`;
      const optionsContainer = document.getElementById('options-container');
      optionsContainer.innerHTML = '';
      current.o.forEach(opt => {
        const div = document.createElement('div');
        div.textContent = `‚ñ∂ ${opt}`;
        div.classList.add('dq-button');
        div.addEventListener('click', () => handleAnswer(opt, current, index));
        optionsContainer.appendChild(div);
      });
    }

    function handleAnswer(selectedAnswer, currentQuiz, index) {
      const isCorrect = selectedAnswer === currentQuiz.a;
      const optionsContainer = document.getElementById('options-container');
      optionsContainer.querySelectorAll('.dq-button').forEach(btn => {
        btn.style.pointerEvents = 'none';
        if (btn.textContent.includes(currentQuiz.a)) {
          btn.classList.add('correct-answer');
        } else {
          btn.classList.add('incorrect-answer');
        }
      });

      if (isCorrect) {
        correctCount++;
        hitSound();
        updateHpBars(100 - (correctCount * (100 / 4)));
        bossContainer.classList.add('shake');
        document.getElementById('explanation-title').textContent = TEXTS[currentLang].correct;
      } else {
        damageSound();
        document.querySelector('.dq-window').classList.add('shake');
        document.getElementById('explanation-title').textContent = TEXTS[currentLang].incorrect;
      }
      
      document.getElementById('explanation-text').textContent = currentQuiz.ex;
      nextQuestionButton.textContent = TEXTS[currentLang].nextButton;
      nextQuestionButton.dataset.nextIndex = index + 1;
      
      setTimeout(() => {
        explanationModal.style.display = 'flex';
      }, 800);
    }
    
    nextQuestionButton.addEventListener('click', () => {
      explanationModal.style.display = 'none';
      bossContainer.classList.remove('shake');
      document.querySelector('.dq-window').classList.remove('shake');
      
      const nextIndex = parseInt(nextQuestionButton.dataset.nextIndex);
      if (nextIndex >= TEXTS[currentLang].quiz.length) {
        showEndScreen();
      } else {
        displayQuestion(nextIndex);
      }
    });

    function showEndScreen() {
      clearInterval(timerInterval);
      bgm.pause();
      bgm.currentTime = 0;
      
      const isVictory = correctCount >= 4;
      if (isVictory) {
        victorySound();
        bossContainer.className = 'boss-defeat';
      } else {
        defeatSound();
      }
      
      setTimeout(() => {
        document.getElementById('boss-area').classList.add('hidden');
        switchScreen('result');
        const t = TEXTS[currentLang];
        document.getElementById('result-title').textContent = isVictory ? t.resultWinTitle : t.resultLoseTitle;
        document.getElementById('result-message').textContent = isVictory ? t.resultWinMsg : t.resultLoseMsg;
        submitResults();
      }, isVictory ? 1500 : 500);
    }

    async function submitResults() {
        const statusEl = document.getElementById('submission-status');
        let ipAddress = 'N/A';
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            ipAddress = (await response.json()).ip;
        } catch (error) {
            console.error('IP„Ç¢„Éâ„É¨„Çπ„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
        }

        const normalizedEmployeeId = normalizeEmployeeIdForHTML(employeeIdInput.value.trim());
        const payload = {
            company: companySelect.value,
            employeeId: normalizedEmployeeId,
            stage: STAGE_NUMBER,
            score: correctCount,
            time: ((Date.now() - startTime) / 1000).toFixed(2),
            ipAddress: ipAddress
        };
        statusEl.textContent = TEXTS[currentLang].submitting;
        
        try {
            const response = await fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8',
                },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (result.status === 'success') {
                if (result.recorded === false) {
                    statusEl.textContent = TEXTS[currentLang].recordedFalse;
                } else {
                    statusEl.textContent = TEXTS[currentLang].submitSuccess;
                }
            } else {
                statusEl.textContent = result.message || TEXTS[currentLang].submitError;
            }
        } catch (err) {
            statusEl.textContent = TEXTS[currentLang].submitError;
            console.error('Error:', err);
        }
    }

    function updateHpBars(percentage) {
      const hpBar = document.getElementById('boss-hp-bar');
      hpBar.style.width = `${Math.max(0, percentage)}%`;
      if (percentage <= 25) hpBar.className = 'boss-hp-bar low';
      else if (percentage <= 50) hpBar.className = 'boss-hp-bar mid';
      else hpBar.className = 'boss-hp-bar full';
    }
    
    function handleMediaError(element) {
        console.error(`Error loading media: ${element.src}`);
        element.style.display = 'none'; 
    }

    document.getElementById('title-start-button').addEventListener('click', async () => {
      if (!audioStarted) { 
        await Tone.start();
        setupAudio();
      }
      clickSound();
      const openingVideo = document.getElementById('opening-video');
      openingVideo.muted = false;
      openingVideo.play().catch(e => console.log("User interaction might be needed for audio"));
      switchScreen('language');
    });

    document.getElementById('lang-ja').addEventListener('click', () => { clickSound(); currentLang = 'ja'; updateUIText(); switchScreen('instruction'); });
    document.getElementById('lang-en').addEventListener('click', () => { clickSound(); currentLang = 'en'; updateUIText(); switchScreen('instruction'); });
    document.getElementById('lang-zh').addEventListener('click', () => { clickSound(); currentLang = 'zh'; updateUIText(); switchScreen('instruction'); });
    
    document.getElementById('instruction-ok-button').addEventListener('click', () => {
      clickSound();
      openingVideoContainer.classList.add('hidden');
      document.getElementById('opening-video').pause();
      gameVideoContainer.classList.remove('hidden');
      document.getElementById('game-bg-video').play().catch(e => console.log("Game video play failed"));
      switchScreen('start');
    });
    
    startButton.addEventListener('click', startGame);
    document.getElementById('restart-button').addEventListener('click', () => location.reload());

    updateUIText();
    switchScreen('title');
    const openingVideo = document.getElementById('opening-video');
    openingVideo.muted = false;
    openingVideo.play().catch(e => {
        console.log("Autoplay with sound was prevented. Muting and retrying.");
        openingVideo.muted = true;
        openingVideo.play();
    });
  </script>
</body>
</html>
