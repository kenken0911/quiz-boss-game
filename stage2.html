<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sustainability Quest üó°Ô∏è - Stage 2</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Press+Start+2P&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <style>
    body[lang="ja"], body[lang="zh"] { font-family: 'DotGothic16', sans-serif; }
    body[lang="en"] { font-family: 'Press Start 2P', cursive; }
    body { background-color: #000; color: #fff; image-rendering: pixelated; overflow-x: hidden; overflow-y: auto; }
    .dq-window { border: 4px solid #fff; background: rgba(0, 50, 0, 0.85); padding: 1.5rem; box-shadow: 0 0 0 4px #000, 0 0 20px rgba(0, 255, 128, 0.5); backdrop-filter: blur(3px); }
    .dq-button { cursor: pointer; padding: .75rem 1.5rem; border: 2px solid #fff; background-image: linear-gradient(to bottom, #00aa55, #008833); text-shadow: 1px 1px 2px #000; transition: all 0.2s; }
    .dq-button:hover { background-image: linear-gradient(to bottom, #33dd88, #00aa55); box-shadow: 0 0 10px #fff; }
    .video-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
    .bg-video { width: 100%; height: 100%; object-fit: cover; }
    #title-screen h1 { font-size: 2.5rem; font-weight: bold; text-shadow: 0 0 5px #fff, 0 0 15px #fff, 0 0 25px #00aaff; animation: fadeInTitle 2s ease-out forwards; }
    #title-start-button { animation: pulseButton 2.5s infinite ease-in-out; }
    @keyframes fadeInTitle { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    @keyframes pulseButton { 0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(255,255,255,0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,1); } }
    .boss-hp-container { border: 2px solid #fff; height: 30px; padding: 3px; background: #333; border-radius: 5px; box-shadow: inset 0 0 5px #000; }
    .boss-hp-bar { height: 100%; transition: width .5s ease-out, background-image .5s ease-out; border-radius: 2px; }
    .boss-hp-bar.full { background-image: linear-gradient(to right, #33ff33, #88ff88); }
    .boss-hp-bar.mid { background-image: linear-gradient(to right, #ffff33, #ffff88); }
    .boss-hp-bar.low { background-image: linear-gradient(to right, #ff3333, #ff8833); }
    .boss-idle { animation: boss-float 2.5s infinite ease-in-out; }
    @keyframes boss-float{ 0%,100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
    .boss-defeat { animation: boss-defeat-anim 1.5s forwards; }
    @keyframes boss-defeat-anim { 0% { opacity: 1; transform: rotate(0deg); } 50% { opacity: 1; transform: rotate(10deg); } 100% { opacity: 0; transform: translateY(100px) rotate(-20deg) scale(0.5); } }
    .shake { animation: shake .35s; }
    @keyframes shake { 10%,90% { transform: translate(-2px, -2px); } 20%,80% { transform: translate(3px, 2px); } 30%,50%,70% { transform: translate(-3px, 3px); } 40%,60% { transform: translate(3px, -2px); } }
    .forest-glow { filter: drop-shadow(0 0 8px #aaff00) drop-shadow(0 0 16px #33dd00) contrast(1.5); }
    #boss-img { width: 100%; max-width: 320px; height: auto; }
    .correct-answer { background-image: linear-gradient(to bottom, #ffdd00, #ffaa00) !important; color: #000; }
    .incorrect-answer { background-image: linear-gradient(to bottom, #888888, #555555) !important; opacity: 0.7; }
  </style>
</head>
<body class="flex items-start sm:items-center justify-center min-h-screen p-4">

  <div id="opening-video-container" class="video-container">
    <video id="opening-video" class="bg-video" src="./opening_movie.mp4" autoplay loop playsinline onerror="handleMediaError(this)"></video>
  </div>
  <div id="game-video-container" class="video-container hidden">
    <video id="game-bg-video" class="bg-video" src="./GameBackground2.mp4" autoplay muted loop playsinline onerror="handleMediaError(this)"></video>
  </div>

  <div class="w-full max-w-3xl mx-auto">
    <div id="boss-area" class="mb-4 h-64 flex justify-center items-end relative hidden">
      <div id="boss-container"><img id="boss-img" src="./Stage2_dragon.png" alt="„Éú„Çπ„ÅÆÁîªÂÉè" class="forest-glow" onerror="handleMediaError(this)"/></div>
    </div>
    <div id="game-container" class="w-full dq-window relative">
      <div id="title-screen" class="text-center py-8">
        <h1 class="mb-10">Sustainability Quest</h1>
        <button id="title-start-button" class="dq-button">START</button>
      </div>

      <div id="language-screen" class="text-center hidden">
        <h1 class="text-3xl font-bold mb-6">Select Language</h1>
        <p class="text-sm mb-6">Translations are provided by AI.</p>
        <div class="flex justify-center gap-2 flex-wrap">
          <button id="lang-ja" class="dq-button">Êó•Êú¨Ë™û</button>
          <button id="lang-en" class="dq-button">English</button>
          <button id="lang-zh" class="dq-button">‰∏≠Êñá</button>
        </div>
      </div>

      <div id="instruction-screen" class="text-center hidden">
        <h1 id="instruction-title" class="text-3xl font-bold mb-4"></h1>
        <div id="instruction-text" class="text-left mb-6 space-y-2"></div>
        <button id="instruction-ok-button" class="dq-button"></button>
      </div>
      
      <div id="start-screen" class="text-center hidden">
        <h1 id="title-text" class="text-2xl font-bold mb-4"></h1>
        <div class="flex flex-col items-center gap-4 mb-4">
          <input id="employeeIdInput" type="text" pattern="\d{5}" title="Á§æÂì°Áï™Âè∑„ÅØÂçäËßíÊï∞Â≠ó5Ê°Å„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" class="text-black px-3 py-2 w-full md:w-80 text-center rounded" />
        </div>
        <button id="start-button" class="dq-button inline-flex items-center gap-2"><span id="start-button-text"></span></button>
        <div id="msg" class="text-yellow-300 text-sm h-5 mt-2"></div>
      </div>

      <div id="quiz-screen" class="hidden">
        <div class="flex justify-between items-center mb-2 text-lg">
          <span id="theme-display"></span>
          <span id="progress-display"></span>
          <span id="timer-display">0.0s</span>
        </div>
        <div class="mb-4"><p id="boss-hp-label"></p><div class="boss-hp-container"><div id="boss-hp-bar"></div></div></div>
        <div class="mb-4 min-h-[80px] p-4 border-2 border-white"><p id="question-text" class="text-xl"></p></div>
        <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
      </div>
      <div id="result-screen" class="hidden text-center">
        <h2 id="result-title" class="text-3xl font-bold mb-4"></h2>
        <p id="result-message" class="text-xl mb-6"></p>
        <p id="submission-status" class="text-yellow-300 mb-8"></p>
        <div id="restart-button" class="dq-button inline-block"></div>
      </div>
      <div id="explanation-modal" class="absolute inset-0 bg-black bg-opacity-80 flex-col items-center justify-center p-4 hidden">
        <div class="dq-window w-full max-w-2xl text-center">
          <h2 id="explanation-title" class="text-4xl font-bold mb-4"></h2>
          <p id="explanation-text" class="text-lg mb-6 text-left h-48 overflow-y-auto p-2 border"></p>
          <button id="next-question-button" class="dq-button"></button>
        </div>
      </div>
    </div>
  </div>
  <audio id="bgm" src="./BS2_BGM.wav" loop onerror="handleMediaError(this)"></audio>
  <audio id="correct-sound" src="./correct_answer.mp3" onerror="handleMediaError(this)"></audio>
  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbyJSdEy7FB8URSCuHC9DoFPHzPOcMS7TVnyFJ-4IGRunK09fLbwSdQxUGQDM0vOZ7wNmA/exec';
    const STAGE_NUMBER = '2';
    const TEXTS = {
      ja: {
        instructionTitle: "ÂÜíÈô∫„ÅÆÂøÉÂæó",
        instructions: ["„Éª„Çµ„Çπ„ÉÜ„Éä„Éì„É™„ÉÜ„Ç£„Å´Èñ¢„Åô„Çã5„Å§„ÅÆÂïèÈ°å„ÅåÂá∫È°å„Åï„Çå„Çã„Åû„ÄÇ", "„Éª4Âïè‰ª•‰∏äÊ≠£Ëß£„Åß„Éú„Çπ„ÇíË®é‰ºê„Åß„Åç„ÇãÔºÅ", "„ÉªÂêÑ„Çπ„ÉÜ„Éº„Ç∏„ÅÆÊúÄÂàù„ÅÆÊåëÊà¶ÁµêÊûú„ÅÆ„Åø„ÅåË®òÈå≤„Åï„Çå„Çã„Åû„ÄÇ", "„ÉªÂÅ•Èóò„ÇíÁ•à„ÇãÔºÅ"],
        instructionOk: "„Çè„Åã„Å£„Åü",
        title: "„Çπ„ÉÜ„Éº„Ç∏2ÔºöÂ§öÊßòÊÄß",
        employeeIdPlaceholder: "Á§æÂì°Áï™Âè∑(ÂçäËßí5Ê°Å)„ÇíÂÖ•Âäõ",
        startButton: "ÊåëÊà¶„Åô„Çã",
        msgEnterId: "Á§æÂì°Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
        msgCheckingId: "ÊåëÊà¶Ë≥áÊ†º„ÇíÁ¢∫Ë™ç‰∏≠...",
        msgIdNotFound: "„Çπ„ÉÜ„Éº„Ç∏1„Åã„ÇâÊåëÊà¶„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
        msgCheckError: "Á¢∫Ë™ç„Ç®„É©„Éº„ÄÇÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        theme: "„ÉÜ„Éº„ÉûÔºöÂ§öÊßòÊÄß",
        progress: (q, t) => `${q}/${t}ÂïèÁõÆ`,
        bossHp: "„Éú„Çπ HP",
        resultWinTitle: "ÂãùÂà©ÔºÅ",
        resultWinMsg: "„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅÂ§öÊßòÊÄß„Å∏„ÅÆÁêÜËß£„ÅåÊ∑±„Åæ„Å£„ÅüÔºÅ",
        resultLoseTitle: "„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº",
        resultLoseMsg: "Á´ú„ÅÆÂÆà„Çä„ÅØÂõ∫„Åã„Å£„Åü‚Ä¶",
        submitting: "ÁµêÊûú„ÇíÈÄÅ‰ø°‰∏≠...",
        submitSuccess: "ÁµêÊûú„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„ÅüÔºÅ",
        submitError: "„Ç®„É©„ÉºÔºöÁµêÊûú„ÇíÈÄÅ‰ø°„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ",
        recordedFalse: "„Éó„É¨„Ç§„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅË®òÈå≤„ÅØÂàùÂõû„ÅÆ„ÇÇ„ÅÆ„ÅÆ„Åø„Å®„Å™„Çä„Åæ„Åô„ÄÇ",
        restartButton: "„Çø„Ç§„Éà„É´„Å∏Êàª„Çã",
        correct: "Ê≠£Ëß£ÔºÅ",
        incorrect: "‰∏çÊ≠£Ëß£...",
        nextButton: "Ê¨°„Å∏",
        quiz: [
            { q: "ÁßÅ„Åü„Å°„ÅÆ‰∏ñÁïå„ÅÆ„ÄåË¶ã„ÅàÊñπ„Äç„ÅØÊñáÂåñ„ÇÑË®ÄË™û„Å´„Çà„Å£„Å¶Áï∞„Å™„Çä„ÄÅ‰æã„Åà„Å∞Ëôπ„ÅÆËâ≤„ÅÆÊï∞„Å´„ÇÇÂ∑Æ„Åå„ÅÇ„Çã„Å®Ë®Ä„Çè„Çå„Åæ„Åô„ÄÇ„Åì„ÅÆ‰∫ãÂÆü„ÅØ„ÄåÂ§öÊßòÊÄß„Äç„Å´„Å§„ÅÑ„Å¶„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å™Êú¨Ë≥™ÁöÑ„Å™Ê∞ó„Å•„Åç„Çí‰∏é„Åà„Å¶„Åè„Çå„Çã„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["ÊñáÂåñ„Å®„ÅÑ„ÅÜ„Éï„Ç£„É´„Çø„Éº„ÇíÈÄö„Åó„Å¶ÁßÅ„Åü„Å°„ÅÆ„ÄåË™çË≠ò„Äç„ÅåÂ§öÊßò„Å™„ÄåÁèæÂÆü„Äç„ÇíÁîü„ÅøÂá∫„Åó„Å¶„ÅÑ„Çã", "‰∏ñÁïå„Åß„ÄåÂîØ‰∏Ä„ÅÆÊ≠£„Åó„ÅÑË™çË≠ò„Äç„ÇíÂÖ±Êúâ„Åô„Çã„Åì„Å®„ÅåÊúÄÁµÇÁõÆÁöÑ„Åß„ÅÇ„Çã", "Áèæ‰ª£ÊñáÂåñ„ÅØÂè§‰ª£ÊñáÂåñ„Çà„Çä‰∏ñÁïå„ÇíÊ≠£Á¢∫„Å´Êçâ„Åà„Å¶„ÅÑ„Çã", "Â§öÊßò„Å™ÊñáÂåñ„ÅÆÊ†πÂ∫ï„Å´„ÅØ„ÄåÂÖ®‰∫∫È°ûÂÖ±ÈÄö„ÅÆÁúüÂÆü„Äç„ÅåÈö†„Åï„Çå„Å¶„ÅÑ„Çã"], a: "ÊñáÂåñ„Å®„ÅÑ„ÅÜ„Éï„Ç£„É´„Çø„Éº„ÇíÈÄö„Åó„Å¶ÁßÅ„Åü„Å°„ÅÆ„ÄåË™çË≠ò„Äç„ÅåÂ§öÊßò„Å™„ÄåÁèæÂÆü„Äç„ÇíÁîü„ÅøÂá∫„Åó„Å¶„ÅÑ„Çã", ex: "Ëôπ„ÅÆËâ≤„ÅÆÊï∞„ÇÇÊñáÂåñ„Å´„Çà„Å£„Å¶Ë™çË≠ò„ÅåÁï∞„Å™„Çä„Åæ„Åô„ÄÇËá™ÂàÜ„ÅåÂΩì„Åü„ÇäÂâç„Å®ÊÄù„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÅåÁõ∏Êâã„Å´„Å®„Å£„Å¶ÂΩì„Åü„ÇäÂâç„Åß„ÅØ„Å™„ÅÑ„Åã„ÇÇ„ÄÅ„Å®„ÅÑ„ÅÜÊÑèË≠ò„ÇíÊåÅ„Å§„Åì„Å®„ÅåÂ§ß‰∫ã„Åß„Åô„ÄÇ" },
            { q: "NKC„Ç∞„É´„Éº„Éó„ÅÆÊã†ÁÇπ„ÅÆ„ÅÇ„ÇãÂêÑÂõΩ„ÅÆÁô∫ÈÖµÈ£üÂìÅ„Å´Èñ¢ÈÄ£„Åó„Å¶„ÄÅË™§„Å£„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„ÅØÊ¨°„ÅÆ„ÅÜ„Å°„Å©„Çå„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["‰∏≠ÂõΩ„ÅÆ„ÄåËÖê‰π≥„Äç„ÅØË±ÜËÖê„Å´„Ç´„Éì„ÇíÊ§ç„Åà‰ªò„Åë„Å¶„Å§„Åè„Çã", "„Éï„Ç£„É™„Éî„É≥Áô∫Á••„ÅÆ„Äå„Éä„Çø„Éª„Éá„Éª„Ç≥„Ç≥„Äç„ÅØ„ÄÅ„Ç≥„Ç≥„Éä„ÉÑ„Éü„É´„ÇØ„ÇíÁô∫ÈÖµ„Åï„Åõ„Å¶„Å§„Åè„Çã", "„Çπ„Ç¶„Çß„Éº„Éá„É≥„ÅÆ„Äå„Ç∑„É•„Éº„É´„Çπ„Éà„É¨„Éü„É≥„Ç∞„Äç„ÅØ„ÄÅ„Éû„Çπ„ÇíÁô∫ÈÖµ„Åï„Åõ„Å¶„Å§„Åè„Çã", "„Ç¢„É°„É™„Ç´„Åß„ÅØ„ÄÅ„ÄåKombucha„Äç„Å®Âëº„Å∞„Çå„ÇãÁ¥ÖËå∂„ÇíÁô∫ÈÖµ„Åï„Åõ„ÅüÈ£≤„ÅøÁâ©„ÅåÈ£≤„Åæ„Çå„Å¶„ÅÑ„Çã"], a: "„Çπ„Ç¶„Çß„Éº„Éá„É≥„ÅÆ„Äå„Ç∑„É•„Éº„É´„Çπ„Éà„É¨„Éü„É≥„Ç∞„Äç„ÅØ„ÄÅ„Éû„Çπ„ÇíÁô∫ÈÖµ„Åï„Åõ„Å¶„Å§„Åè„Çã", ex: "„Çπ„Ç¶„Çß„Éº„Éá„É≥„ÅÆ„Äå„Ç∑„É•„Éº„É´„Çπ„Éà„É¨„Éü„É≥„Ç∞„Äç„ÅØ„Äå„Éû„Çπ„Äç„Åß„ÅØ„Å™„Åè„Äå„Éã„Ç∑„É≥„Äç„ÇíÁô∫ÈÖµ„Åï„Åõ„Å¶„Å§„Åè„Çâ„Çå„Åæ„Åô„ÄÇ„Äå‰∏ñÁïå„ÅßÊúÄ„ÇÇËá≠„ÅÑÈ£ü„ÅπÁâ©„Äç„Å®„ÇÇÂëº„Å∞„Çå„Åæ„Åô„ÄÇ" },
            { q: "Â§öÊßò„Å™‰∫∫Êùê„ÅßÊßãÊàê„Åï„Çå„Åü„ÉÅ„Éº„É†„ÅåÈ´ò„ÅÑÊàêÊûú„ÇíÂá∫„ÅôÊúÄ„ÇÇÈáçË¶Å„Å™ÁêÜÁî±„ÅØÊ¨°„ÅÆ„ÅÜ„Å°„Å©„Çå„Åß„Åó„Çá„ÅÜ„ÅãÔºü", o: ["„Éû„Ç§„Éé„É™„ÉÜ„Ç£‰∫∫Êùê„ÅØ„ÄÅÊú¨Ë≥™ÁöÑ„Å´ÂâµÈÄ†ÊÄß„ÅåË±ä„Åã„Å†„Åã„Çâ", "Êßò„ÄÖ„Å™Ë¶ñÁÇπ„ÇÑÁü•Ë≠ò„ÅåÁµÑ„ÅøÂêà„Çè„Åï„Çã„Åì„Å®„Åß„ÄÅÂÄã‰∫∫„ÅÆ„ÄåË¶ñÁÇπ„ÅÆÊ≠ªËßí„Äç„ÇíË£ú„ÅÑÂêà„Åà„Çã„Åã„Çâ", "ÂØæÁ´ã„ÇíÈÅø„Åë„Çã„Åì„Å®„Åß„ÄÅÁ©è‰æø„Å´ÁµêË´ñ„ÇíÂá∫„Åõ„Çã„Åã„Çâ", "„ÉÅ„Éº„É†ÂÜÖ„ÅÆ‰∫∫ÈñìÈñ¢‰øÇ„ÅåÂÜÜÊªë„Å´„Å™„Çä„ÄÅÂçîÂäõ„Åó„ÇÑ„Åô„Åè„Å™„Çã„Åã„Çâ"], a: "Êßò„ÄÖ„Å™Ë¶ñÁÇπ„ÇÑÁü•Ë≠ò„ÅåÁµÑ„ÅøÂêà„Çè„Åï„Çã„Åì„Å®„Åß„ÄÅÂÄã‰∫∫„ÅÆ„ÄåË¶ñÁÇπ„ÅÆÊ≠ªËßí„Äç„ÇíË£ú„ÅÑÂêà„Åà„Çã„Åã„Çâ", ex: "Â§öÊßò„Å™„ÉÅ„Éº„É†„ÅÆÁúü‰æ°„ÅØ„ÄÅÁï∞„Å™„ÇãË¶ñÁÇπ„ÅÆÂ≠òÂú®„Åå„ÄÅ„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆÊÄùËÄÉ„Éó„É≠„Çª„Çπ„Å´„Åä„Åë„Çã„ÄåÊ≠ªËßí„Äç„ÇíÊ∏õ„Çâ„Åó„ÄÅÁ∑èÂêàÁöÑ„Å´Áâ©‰∫ã„ÇíËÄÉÊÖÆ„Åó„Å¶ÂØæÂá¶„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„ÇãÁÇπ„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ" },
            { q: "Ëã±Ë™û„ÅÆ„Åì„Å®„Çè„Åñ„ÄåVariety is the spice of life.„Äç(Â§öÊßòÊÄß„ÅØ‰∫∫Áîü„ÅÆ„Çπ„Éë„Ç§„Çπ„Å†)„Åå‰ºù„Åà„Åü„ÅÑÊúÄ„ÇÇÈáçË¶Å„Å™„É°„ÉÉ„Çª„Éº„Ç∏„ÅØÔºü", o: ["Êñ∞„Åó„ÅÑÁµåÈ®ì„ÇÑÂ§âÂåñ„ÄÅÈÅï„ÅÑ„Åå„ÅÇ„Çã„Åì„Å®„Åß„ÄÅ‰∫∫Áîü„ÅØ„Çà„ÇäÈù¢ÁôΩ„Åè„ÄÅË±ä„Åã„Å´„Å™„Çã", "Â§öÊßò„Å™Áü•Ë≠ò„Åå„ÅÇ„Çå„Å∞„ÄÅ‰∫∫Áîü„ÅÆÂõ∞Èõ£„Çí‰πó„ÇäË∂ä„Åà„ÇãËøëÈÅì„ÅåË¶ã„Å§„Åã„Çã", "Â§öÊßò„Å™‰æ°ÂÄ§Ë¶≥„Å´Ëß¶„Çå„Çã„Åì„Å®„Åß„ÄÅ‰∫∫Áîü„Å´„Åä„Åë„ÇãÂîØ‰∏Ä„ÅÆÊ≠£„Åó„ÅÑÈÅì„Åå„Çè„Åã„Çã", "Â§öÊßò„Å™ÈÅ∏ÊäûËÇ¢„Åå„ÅÇ„Çä„Åô„Åé„Çã„Å®„ÄÅÊ±∫Êñ≠„ÇíËø∑„Çè„Åõ„Å¶„Åó„Åæ„ÅÜ"], a: "Êñ∞„Åó„ÅÑÁµåÈ®ì„ÇÑÂ§âÂåñ„ÄÅÈÅï„ÅÑ„Åå„ÅÇ„Çã„Åì„Å®„Åß„ÄÅ‰∫∫Áîü„ÅØ„Çà„ÇäÈù¢ÁôΩ„Åè„ÄÅË±ä„Åã„Å´„Å™„Çã", ex: "„Åì„ÅÆ„Åì„Å®„Çè„Åñ„ÅØ„ÄÅÊñ∞„Åó„ÅÑÁµåÈ®ì„ÇÑÂ§âÂåñ„Åå‰∫∫Áîü„Çí„Çà„ÇäÈù¢ÁôΩ„Åè„Åô„Çã„Å®„ÅÑ„ÅÜÊÑèÂë≥„Åß„Åô„ÄÇÊßò„ÄÖ„Å™‰æ°ÂÄ§Ë¶≥„ÇÑÁµåÈ®ì„Å´Ëß¶„Çå„Çã„Åì„Å®„Åß‰∫∫Áîü„ÅåË±ä„Åã„Å´„Å™„Çã„Åì„Å®„ÇíÁ§∫ÂîÜ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ" },
            { q: "ÊôÇÈñì„ÅÆÊçâ„ÅàÊñπ„ÇÇÂõΩ„ÇÑÊñáÂåñ„Å´„Çà„Å£„Å¶Â§öÊßò„Åß„Åô„ÄÇÂêÑÂõΩ„ÅÆÁâπÂæ¥„Å®„Åó„Å¶Ë®Ä„Çè„Çå„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„Åß„ÄÅË™§„Å£„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„ÅØÔºü", o: ["„Çπ„Ç¶„Çß„Éº„Éá„É≥„Å´„ÅØ„ÄåFika(„Éï„Ç£„Éº„Ç´)„Äç„Å®„ÅÑ„ÅÜ„Ç≥„Éº„Éí„Éº„Éñ„É¨„Ç§„ÇØÊñáÂåñ„Åå„ÅÇ„Çã", "„Ç¢„É°„É™„Ç´„Åß„ÅØ„ÄåTime is money.„Äç„ÅÆ„Çà„ÅÜ„Å´ÂäπÁéáÊÄß„ÅåÈáçË¶ñ„Åï„Çå„Çã", "‰∏≠ÂõΩ„Åß„ÅØÂ∞ÜÊù•„ÅÆ„Åü„ÇÅ„ÅÆ„ÄåÈï∑ÊúüÂøóÂêë„Äç„ÅåÂº∑„ÅÑ", "„Éï„Ç£„É™„Éî„É≥„Åß„ÅØ‰∫∫ÈñìÈñ¢‰øÇ„ÇíÂ§ßÂàá„Å´„Åô„Çã„Åü„ÇÅ„ÄÅÊôÇÈñì„Å´Âé≥Ê†º„Åß„ÅÇ„Çã"], a: "„Éï„Ç£„É™„Éî„É≥„Åß„ÅØ‰∫∫ÈñìÈñ¢‰øÇ„ÇíÂ§ßÂàá„Å´„Åô„Çã„Åü„ÇÅ„ÄÅÊôÇÈñì„Å´Âé≥Ê†º„Åß„ÅÇ„Çã", ex: "„Éï„Ç£„É™„Éî„É≥„Å´„ÅØ„ÄÅ„Åù„ÅÆÂ†¥„ÅÆ‰∫∫ÈñìÈñ¢‰øÇ„ÇíÂÑ™ÂÖà„Åô„ÇãÂÇæÂêë„Åå„ÅÇ„Çä„ÄÅÊôÇÈñì„Å´ÂØõÂÆπ„Å™„ÄåFilipino Time„Äç„Å®„ÅÑ„ÅÜË®ÄËëâ„ÅåÂ≠òÂú®„Åó„Åæ„Åô„ÄÇÔºàÊñáÂåñ„ÅÆÂ§öÊßòÊÄß„ÇíÁ§∫„Åô‰∏ÄËà¨Ë´ñ„Åß„ÅÇ„Çä„ÄÅ„Çπ„ÉÜ„É¨„Ç™„Çø„Ç§„Éó„Å´Èô•„Çâ„Å™„ÅÑ„Çà„ÅÜÊ≥®ÊÑè„Åó„Åæ„Åó„Çá„ÅÜÔºâ" }
        ]
      },
      en: {
        instructionTitle: "Rules of the Quest",
        instructions: ["- You will be asked 5 questions about sustainability.", "- Answer 4 or more correctly to defeat the boss!", "- Only your first attempt on each stage will be recorded.", "- Good luck!"],
        instructionOk: "Got it",
        title: "Stage 2: Diversity",
        employeeIdPlaceholder: "Enter 5-digit Employee ID",
        startButton: "Challenge",
        msgEnterId: "Please enter your Employee ID",
        msgCheckingId: "Checking eligibility...",
        msgIdNotFound: "Please complete Stage 1 first!",
        msgCheckError: "Verification error. Please try again later.",
        theme: "Theme: Diversity",
        progress: (q, t) => `Q ${q}/${t}`,
        bossHp: "Boss HP",
        resultWinTitle: "Victory!",
        resultWinMsg: "Stage Clear! Your understanding of diversity has deepened!",
        resultLoseTitle: "Game Over",
        resultLoseMsg: "The dragon's defense was solid...",
        submitting: "Submitting results...",
        submitSuccess: "Results submitted!",
        submitError: "Error: Could not submit results.",
        recordedFalse: "Thanks for playing! Only your first result is recorded.",
        restartButton: "Back to Title",
        correct: "Correct!",
        incorrect: "Incorrect...",
        nextButton: "Next",
        quiz: [
            { q: "The way we 'see' the world differs by culture. For example, the number of colors in a rainbow. What essential insight does this give us about diversity?", o: ["Our 'perception' creates diverse 'realities' through the filter of culture", "The ultimate goal is to share a 'single correct perception' of the world", "Modern cultures perceive the world more accurately than ancient ones", "A 'common human truth' is hidden beneath diverse cultures"], a: "Our 'perception' creates diverse 'realities' through the filter of culture", ex: "The number of colors seen in a rainbow differs by culture. It's important to realize that what you consider normal may not be normal for others." },
            { q: "Regarding fermented foods from countries where the NKC Group has locations, which of the following is incorrect?", o: ["Chinese 'furu' (fermented tofu) is made by inoculating tofu with mold", "Filipino 'nata de coco' is made by fermenting coconut milk", "Swedish 'surstr√∂mming' is made by fermenting trout", "In the US, a beverage called 'Kombucha' made from fermented tea is popular"], a: "Swedish 'surstr√∂mming' is made by fermenting trout", ex: "Swedish 'surstr√∂mming' is made by fermenting 'herring,' not 'trout.' It is known as one of the smelliest foods in the world." },
            { q: "What is the most important reason that diverse teams often outperform homogeneous teams in problem-solving?", o: ["Minority individuals are inherently more creative", "Various perspectives and knowledge compensate for individual 'blind spots'", "They can reach conclusions amicably by avoiding conflict", "Interpersonal relationships within the team become smoother"], a: "Various perspectives and knowledge compensate for individual 'blind spots'", ex: "The true value of a diverse team is that different viewpoints reduce the team's overall 'blind spots,' allowing for more comprehensive consideration of matters." },
            { q: "What is the most important message of the English proverb, 'Variety is the spice of life'?", o: ["New experiences, changes, and differences make life more interesting and rich", "Diverse knowledge provides shortcuts to overcome life's difficulties", "Experiencing diverse values reveals the one true path in life", "Too many options can make important life decisions more difficult"], a: "New experiences, changes, and differences make life more interesting and rich", ex: "This proverb means that new experiences and changes make life more interesting. It suggests that encountering diverse values and experiences enriches one's life." },
            { q: "The perception of time varies by culture. Which of the following generalizations about different countries is incorrect?", o: ["In Sweden, people value work-life balance and have a coffee break called 'Fika'", "In the US, efficiency is valued, as in 'Time is money'", "In China, there is a strong 'long-term orientation' for future success", "In the Philippines, people are strict about punctuality out of respect for relationships"], a: "In the Philippines, people are strict about punctuality out of respect for relationships", ex: "In the Philippines, there is a tendency to prioritize immediate personal relationships over schedules, leading to the term 'Filipino Time,' which signifies a relaxed attitude toward time. (This is a generalization to illustrate cultural diversity and not a stereotype.)" }
        ]
      },
      zh: {
        instructionTitle: "ÂÜíÈô©È°ªÁü•",
        instructions: ["„ÉªÂ∞ÜÊèêÂá∫5‰∏™ÂÖ≥‰∫éÂèØÊåÅÁª≠ÊÄßÁöÑÈóÆÈ¢ò„ÄÇ", "„ÉªÊ≠£Á°ÆÂõûÁ≠î4‰∏™‰ª•‰∏äÈóÆÈ¢òÂç≥ÂèØÂáªË¥•Â§¥ÁõÆÔºÅ", "„ÉªÊØè‰∏™ÂÖ≥Âç°Âè™ÊúâÁ¨¨‰∏ÄÊ¨°ÊåëÊàòÁöÑÁªìÊûú‰ºöË¢´ËÆ∞ÂΩï„ÄÇ", "„ÉªÁ•ù‰Ω†Â•ΩËøêÔºÅ"],
        instructionOk: "Áü•ÈÅì‰∫Ü",
        title: "Á¨¨‰∫åÂÖ≥ÔºöÂ§öÊ†∑ÊÄß",
        employeeIdPlaceholder: "ËæìÂÖ•ÂëòÂ∑•ÁºñÂè∑(5‰ΩçÂçäËßíÊï∞Â≠ó)",
        startButton: "ÊåëÊàò",
        msgEnterId: "ËØ∑ËæìÂÖ•ÂëòÂ∑•ÁºñÂè∑",
        msgCheckingId: "Ê≠£Âú®Á°ÆËÆ§ÊåëÊàòËµÑÊ†º...",
        msgIdNotFound: "ËØ∑ÂÖàÊåëÊàòÁ¨¨‰∏ÄÂÖ≥ÔºÅ",
        msgCheckError: "Á°ÆËÆ§Âá∫Èîô„ÄÇËØ∑Á®çÂêéÂÜçËØï„ÄÇ",
        theme: "‰∏ªÈ¢òÔºöÂ§öÊ†∑ÊÄß",
        progress: (q, t) => `Á¨¨${q}/${t}È¢ò`,
        bossHp: "Â§¥ÁõÆ HP",
        resultWinTitle: "ËÉúÂà©ÔºÅ",
        resultWinMsg: "ÂÖ≥Âç°ÂÆåÊàêÔºÅÂä†Ê∑±‰∫ÜÂØπÂ§öÊ†∑ÊÄßÁöÑÁêÜËß£ÔºÅ",
        resultLoseTitle: "Ê∏∏ÊàèÁªìÊùü",
        resultLoseMsg: "ÈæôÁöÑÈò≤Âæ°ÂæàÂùöÂõ∫‚Ä¶",
        submitting: "Ê≠£Âú®ÂèëÈÄÅÁªìÊûú...",
        submitSuccess: "ÁªìÊûúÂ∑≤ÂèëÈÄÅÔºÅ",
        submitError: "ÈîôËØØÔºöÊó†Ê≥ïÂèëÈÄÅÁªìÊûú„ÄÇ",
        recordedFalse: "ÊÑüË∞¢ÊÇ®ÁöÑÂèÇ‰∏éÔºÅÂè™ÊúâÂàùÊ¨°ÊåëÊàòÁªìÊûú‰ºöË¢´ËÆ∞ÂΩï„ÄÇ",
        restartButton: "ËøîÂõûÊ†áÈ¢ò",
        correct: "ÂõûÁ≠îÊ≠£Á°ÆÔºÅ",
        incorrect: "ÂõûÁ≠îÈîôËØØ...",
        nextButton: "‰∏ã‰∏Ä‰∏™",
        quiz: [
            { q: "Êàë‰ª¨‚ÄúÁúãÂæÖ‚Äù‰∏ñÁïåÁöÑÊñπÂºèÂõ†ÊñáÂåñËÄåÂºÇÔºå‰æãÂ¶ÇÂØπÂΩ©ËôπÈ¢úËâ≤ÁöÑËÆ§Áü•„ÄÇËøô‰∏Ä‰∫ãÂÆû‰∏∫Êàë‰ª¨Êèê‰æõ‰∫ÜÂÖ≥‰∫é‚ÄúÂ§öÊ†∑ÊÄß‚ÄùÁöÑ‰ΩïÁßçÊú¨Ë¥®ÊÄßÂêØÁ§∫Ôºü", o: ["Êàë‰ª¨ÁöÑ‚ÄúËÆ§Áü•‚ÄùÈÄöËøáÊñáÂåñÁöÑÊª§ÈïúÂàõÈÄ†Âá∫Â§öÊ†∑ÁöÑ‚ÄúÁé∞ÂÆû‚Äù", "ÊúÄÁªàÁõÆÊ†áÊòØÂÖ±‰∫´‰∏Ä‰∏™‚ÄúÂîØ‰∏ÄÊ≠£Á°ÆÁöÑÂÖ®ÁêÉËÆ§Áü•‚Äù", "Áé∞‰ª£ÊñáÂåñÊØîÂè§‰ª£ÊñáÂåñÊõ¥ÂáÜÁ°ÆÂú∞ÊääÊè°‰∏ñÁïå", "Â§öÊ†∑ÊñáÂåñÁöÑÊ†πÂü∫‰∏ãÈöêËóèÁùÄ‚ÄúÂÖ®‰∫∫Á±ªÂÖ±ÈÄöÁöÑÁúüÁêÜ‚Äù"], a: "Êàë‰ª¨ÁöÑ‚ÄúËÆ§Áü•‚ÄùÈÄöËøáÊñáÂåñÁöÑÊª§Èè°ÂàõÈÄ†Âá∫Â§öÊ†∑ÁöÑ‚ÄúÁé∞ÂÆû‚Äù", ex: "ÂØπÂΩ©ËôπÈ¢úËâ≤ÁöÑËÆ§Áü•Âõ†ÊñáÂåñËÄåÂºÇ„ÄÇÈáçË¶ÅÁöÑÊòØË¶ÅÊÑèËØÜÂà∞Ôºå‰Ω†ËÆ§‰∏∫ÁêÜÊâÄÂΩìÁÑ∂ÁöÑ‰∫ãÊÉÖÔºåÂØπ‰ªñ‰∫∫ËÄåË®ÄÂèØËÉΩÂπ∂ÈùûÂ¶ÇÊ≠§„ÄÇ" },
            { q: "ÂÖ≥‰∫éNKCÈõÜÂõ¢ËÆæÊúâÊçÆÁÇπÁöÑÂêÑÂõΩÁöÑÂèëÈÖµÈ£üÂìÅÔºå‰ª•‰∏ãÂì™È°πÊòØÈîôËØØÁöÑÔºü", o: ["‰∏≠ÂõΩÁöÑ‚ÄúËÖê‰π≥‚ÄùÊòØÈÄöËøáÂú®Ë±ÜËÖê‰∏äÊé•ÁßçÈúâËèåÂà∂ÊàêÁöÑ", "Ëè≤ÂæãÂÆæÁöÑ‚ÄúÊ§∞Êûú‚ÄùÊòØÈÄöËøáÂèëÈÖµÊ§∞Â•∂Âà∂ÊàêÁöÑ", "ÁëûÂÖ∏ÁöÑ‚ÄúÁëûÂÖ∏ÁõêËÖåÈ≤±È±º‚ÄùÊòØÈÄöËøáÂèëÈÖµÈ≥üÈ±ºÂà∂ÊàêÁöÑ", "Âú®ÁæéÂõΩÔºå‰∏ÄÁßçÂêç‰∏∫‚ÄúÂ∫∑ÊôÆËå∂‚ÄùÁöÑÂèëÈÖµÁ∫¢Ëå∂È•ÆÊñôÂæàÂèóÊ¨¢Ëøé"], a: "ÁëûÂÖ∏ÁöÑ‚ÄúÁëûÂÖ∏ÁõêËÖåÈ≤±È±º‚ÄùÊòØÈÄöËøáÂèëÈÖµÈ≥üÈ±ºÂà∂ÊàêÁöÑ", ex: "ÁëûÂÖ∏ÁöÑ‚ÄúÁëûÂÖ∏ÁõêËÖåÈ≤±È±º‚ÄùÊòØÂèëÈÖµ‚ÄúÈ≤±È±º‚ÄùËÄåÈùû‚ÄúÈ≥üÈ±º‚ÄùÂà∂Êàê„ÄÇÂÆÉË¢´Áß∞‰∏∫‰∏ñÁïå‰∏äÊúÄËá≠ÁöÑÈ£üÁâ©‰πã‰∏Ä„ÄÇ" },
            { q: "Â§öÂÖÉÂåñÂõ¢ÈòüÂú®Ëß£ÂÜ≥ÈóÆÈ¢òÊó∂ÈÄöÂ∏∏‰ºò‰∫éÂêåË¥®ÂåñÂõ¢ÈòüÔºåÂÖ∂ÊúÄÈáçË¶ÅÁöÑÂéüÂõ†ÊòØ‰ªÄ‰πàÔºü", o: ["Â∞ëÊï∞Áæ§‰ΩìÊàêÂëòÂ§©ÁîüÊõ¥ÂÖ∑ÂàõÈÄ†Âäõ", "‰∏çÂêåÁöÑËßÜËßíÂíåÁü•ËØÜËÉΩÂº•Ë°•‰∏™‰∫∫ÁöÑ‚ÄúÁõ≤ÁÇπ‚Äù", "ÈÄöËøáÈÅøÂÖçÂÜ≤Á™ÅÔºåËÉΩÂíåÂπ≥Âú∞ÂæóÂá∫ÁªìËÆ∫", "Âõ¢ÈòüÂÜÖÈÉ®ÁöÑ‰∫∫ÈôÖÂÖ≥Á≥ªÊõ¥È°∫ÁïÖ"], a: "‰∏çÂêåÁöÑËßÜËßíÂíåÁü•ËØÜËÉΩÂº•Ë°•‰∏™‰∫∫ÁöÑ‚ÄúÁõ≤ÁÇπ‚Äù", ex: "Â§öÂÖÉÂåñÂõ¢ÈòüÁöÑÁúüÊ≠£‰ª∑ÂÄºÂú®‰∫éÔºå‰∏çÂêåÁöÑËßÇÁÇπËÉΩÂáèÂ∞ëÂõ¢ÈòüÊï¥‰ΩìÁöÑ‚ÄúÁõ≤ÁÇπ‚ÄùÔºå‰ªéËÄåËÉΩÂ§üÊõ¥ÂÖ®Èù¢Âú∞ËÄÉËôëÈóÆÈ¢ò„ÄÇ" },
            { q: "Ëã±ËØ≠Ë∞öËØ≠‚ÄúVariety is the spice of life.‚ÄùÔºàÂ§öÊ†∑ÊÄßÊòØÁîüÊ¥ªÁöÑË∞ÉÂë≥ÂìÅÔºâ‰º†ËææÁöÑÊúÄÈáçË¶ÅÁöÑ‰ø°ÊÅØÊòØ‰ªÄ‰πàÔºü", o: ["Êñ∞ÁöÑ‰ΩìÈ™å„ÄÅÂèòÂåñÂíåÂ∑ÆÂºÇ‰ΩøÁîüÊ¥ªÊõ¥ÊúâË∂£„ÄÅÊõ¥‰∏∞ÂØå", "‰∏∞ÂØåÁöÑÁü•ËØÜËÉΩ‰∏∫ÂÖãÊúçÁîüÊ¥ªÂõ∞ÈöæÊèê‰æõÊç∑ÂæÑ", "Êé•Ëß¶Â§öÊ†∑ÁöÑ‰ª∑ÂÄºËßÇËÉΩÊè≠Á§∫ÁîüÊ¥ª‰∏≠ÂîØ‰∏ÄÊ≠£Á°ÆÁöÑÈÅìË∑Ø", "ËøáÂ§öÁöÑÈÄâÊã©‰ºö‰Ωø‰∫∫ÁîüÁöÑÈáçË¶ÅÂÜ≥Á≠ñÊõ¥Âä†Âõ∞Èöæ"], a: "Êñ∞ÁöÑ‰ΩìÈ™å„ÄÅÂèòÂåñÂíåÂ∑ÆÂºÇ‰ΩøÁîüÊ¥ªÊõ¥ÊúâË∂£„ÄÅÊõ¥‰∏∞ÂØå", ex: "ËøôÂè•Ë∞öËØ≠ÊÑèÂë≥ÁùÄÊñ∞ÁöÑ‰ΩìÈ™åÂíåÂèòÂåñ‰ΩøÁîüÊ¥ªÊõ¥ÊúâË∂£„ÄÇÂÆÉË°®ÊòéÔºåÊé•Ëß¶‰∏çÂêåÁöÑ‰ª∑ÂÄºËßÇÂíåÁªèÈ™åËÉΩ‰∏∞ÂØå‰∏Ä‰∏™‰∫∫ÁöÑÁîüÊ¥ª„ÄÇ" },
            { q: "ÂØπÊó∂Èó¥ÁöÑÁúãÊ≥ï‰πüÂõ†ÊñáÂåñËÄåÂºÇ„ÄÇ‰ª•‰∏ãÂÖ≥‰∫é‰∏çÂêåÂõΩÂÆ∂ÊôÆÈÅçÁâπÂæÅÁöÑËØ¥Ê≥ï‰∏≠ÔºåÂì™È°πÊòØÈîôËØØÁöÑÔºü", o: ["Âú®ÁëûÂÖ∏Ôºå‰∫∫‰ª¨ÈáçËßÜÂ∑•‰Ωú‰∏éÁîüÊ¥ªÁöÑÂπ≥Ë°°ÔºåÊúâÁß∞‰∏∫‚ÄúFika‚ÄùÁöÑÂíñÂï°‰ºëÊÅØÊó∂Èó¥", "Âú®ÁæéÂõΩÔºåÊïàÁéáÂèóÂà∞ÈáçËßÜÔºåÂ¶Ç‚ÄúÊó∂Èó¥Â∞±ÊòØÈáëÈí±‚Äù", "Âú®‰∏≠ÂõΩÔºå‰∏∫Êú™Êù•ÊàêÂäüÊúâÂº∫ÁÉàÁöÑ‚ÄúÈïøÊúüÂØºÂêë‚Äù", "Âú®Ëè≤ÂæãÂÆæÔºåÂá∫‰∫éÂØπ‰∫∫ÈôÖÂÖ≥Á≥ªÁöÑÂ∞äÈáçÔºå‰∫∫‰ª¨ÂØπÂÆàÊó∂Ë¶ÅÊ±Ç‰∏•Ê†º"], a: "Âú®Ëè≤ÂæãÂÆæÔºåÂá∫‰∫éÂØπ‰∫∫ÈôÖÂÖ≥Á≥ªÁöÑÂ∞äÈáçÔºå‰∫∫‰ª¨ÂØπÂÆàÊó∂Ë¶ÅÊ±Ç‰∏•Ê†º", ex: "Âú®Ëè≤ÂæãÂÆæÔºå‰∫∫‰ª¨ÂÄæÂêë‰∫é‰ºòÂÖàËÄÉËôëÂΩìÂâçÁöÑ‰∫∫ÈôÖÂÖ≥Á≥ªËÄåÈùûÊó•Á®ãÂÆâÊéíÔºåÂõ†Ê≠§Êúâ‚ÄúËè≤ÂæãÂÆæÊó∂Èó¥‚Äù‰∏ÄËØçÔºåË°®Á§∫ÂØπÊó∂Èó¥ÁöÑÂÆΩÊùæÊÄÅÂ∫¶„ÄÇÔºàËøôÊòØ‰∏Ä‰∏™‰∏∫ËØ¥ÊòéÊñáÂåñÂ§öÊ†∑ÊÄßËÄå‰∏æÁöÑÊôÆÈÅç‰æãÂ≠êÔºå‰∏çÂ∫îËßÜ‰∏∫ÂàªÊùøÂç∞Ë±°„ÄÇÔºâ" }
        ]
      }
    };
    
    const titleScreen = document.getElementById('title-screen');
    const languageScreen = document.getElementById('language-screen');
    const instructionScreen = document.getElementById('instruction-screen');
    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const bossContainer = document.getElementById('boss-container');
    const employeeIdInput = document.getElementById('employeeIdInput');
    const bgm = document.getElementById('bgm');
    const correctSound = document.getElementById('correct-sound');
    const startButton = document.getElementById('start-button');
    const explanationModal = document.getElementById('explanation-modal');
    const nextQuestionButton = document.getElementById('next-question-button');
    const openingVideoContainer = document.getElementById('opening-video-container');
    const gameVideoContainer = document.getElementById('game-video-container');

    let currentLang = 'ja';
    let timerInterval, startTime, correctCount, isGameInProgress = false, audioStarted = false;
    let clickSound, hitSound, damageSound, victorySound, defeatSound;

    function switchScreen(screenName) {
      [titleScreen, languageScreen, instructionScreen, startScreen, quizScreen, resultScreen].forEach(s => s.classList.add('hidden'));
      document.getElementById(`${screenName}-screen`).classList.remove('hidden');
    }
    
    function updateUIText() {
      const t = TEXTS[currentLang];
      document.body.lang = currentLang;
      document.getElementById('instruction-title').textContent = t.instructionTitle;
      document.getElementById('instruction-text').innerHTML = t.instructions.map(line => `<p>${line}</p>`).join('');
      document.getElementById('instruction-ok-button').textContent = t.instructionOk;
      document.getElementById('title-text').textContent = t.title;
      employeeIdInput.placeholder = t.employeeIdPlaceholder;
      document.getElementById('start-button-text').textContent = t.startButton;
      document.getElementById('boss-hp-label').textContent = t.bossHp;
      document.getElementById('restart-button').textContent = t.restartButton;
      document.getElementById('theme-display').textContent = t.theme;
    }

    function setupAudio() {
      if (audioStarted) return;
      clickSound = () => new Tone.MembraneSynth({ pitchDecay: 0.01, octaves: 3, envelope: { attack: 0.001, decay: 0.3, sustain: 0 } }).toDestination().triggerAttackRelease("C2", "8n");
      hitSound = () => {
        correctSound.currentTime = 0;
        correctSound.play().catch(e => console.error("Correct sound play failed:", e));
      };
      damageSound = () => new Tone.NoiseSynth({ noise: { type: "pink" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.2 } }).toDestination().triggerAttackRelease("8n");
      victorySound = () => { const s = new Tone.Synth().toDestination(), n = Tone.now(); s.triggerAttackRelease("C5", "8n", n); s.triggerAttackRelease("E5", "8n", n + 0.2); s.triggerAttackRelease("G5", "8n", n + 0.4); s.triggerAttackRelease("C6", "4n", n + 0.6) };
      defeatSound = () => { const s = new Tone.Synth().toDestination(), n = Tone.now(); s.triggerAttackRelease("C4", "4n", n); s.triggerAttackRelease("B3", "4n", n + 0.3); s.triggerAttackRelease("A#3", "4n", n + 0.6); s.triggerAttackRelease("A3", "2n", n + 0.9) };
      audioStarted = true;
    }

    // ‚òÖËøΩÂä†: HTMLÂÅ¥„Å´„ÇÇÊ≠£Ë¶èÂåñÈñ¢Êï∞„ÇíÂÆöÁæ©
    function normalizeEmployeeIdForHTML(v) {
      const digits = String(v == null ? "" : v).replace(/[^\d]/g, "");
      return digits.padStart(5, "0");
    }

    async function startGame() {
      if (!employeeIdInput.checkValidity()) {
        employeeIdInput.reportValidity();
        return;
      }
      const employeeId = employeeIdInput.value.trim();
      const msgEl = document.getElementById('msg');
      if (!employeeId) {
        msgEl.textContent = TEXTS[currentLang].msgEnterId;
        return;
      }
      if (isGameInProgress) return;
      isGameInProgress = true;
      startButton.disabled = true;
      msgEl.textContent = TEXTS[currentLang].msgCheckingId;

      // ‚òÖÂ§âÊõ¥: ÈÄÅ‰ø°„Åô„ÇãÂâç„Å´Á§æÂì°Áï™Âè∑„ÇíÊ≠£Ë¶èÂåñ
      const normalizedEmployeeId = normalizeEmployeeIdForHTML(employeeId);

      try {
        const checkUrl = `${GAS_URL}?action=checkEmployeeId&employeeId=${encodeURIComponent(normalizedEmployeeId)}`;
        const response = await fetch(checkUrl);
        const result = await response.json();

        if (result.exists) {
          msgEl.textContent = "";
          bgm.play().catch(e => console.error("BGM play failed:", e));
          clickSound();
          correctCount = 0;
          document.getElementById('boss-area').classList.remove('hidden');
          bossContainer.className = 'boss-idle';
          updateHpBars(100);
          switchScreen('quiz');
          startTime = Date.now();
          timerInterval = setInterval(() => {
            const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('timer-display').textContent = `${elapsedTime}s`;
          }, 100);
          displayQuestion(0);
        } else {
          msgEl.textContent = TEXTS[currentLang].msgIdNotFound;
        }
      } catch (error) {
        console.error("Error checking employee ID:", error);
        msgEl.textContent = TEXTS[currentLang].msgCheckError;
      } finally {
        isGameInProgress = false;
        startButton.disabled = false;
      }
    }

    function displayQuestion(index) {
      const quizData = TEXTS[currentLang].quiz;
      document.getElementById('progress-display').textContent = TEXTS[currentLang].progress(index + 1, quizData.length);
      const current = quizData[index];
      document.getElementById('question-text').textContent = `Q${index + 1}: ${current.q}`;
      const optionsContainer = document.getElementById('options-container');
      optionsContainer.innerHTML = '';
      current.o.forEach(opt => {
        const div = document.createElement('div');
        div.textContent = `‚ñ∂ ${opt}`;
        div.classList.add('dq-button');
        div.addEventListener('click', () => handleAnswer(opt, current, index));
        optionsContainer.appendChild(div);
      });
    }

    function handleAnswer(selectedAnswer, currentQuiz, index) {
      const isCorrect = selectedAnswer === currentQuiz.a;
      const optionsContainer = document.getElementById('options-container');
      optionsContainer.querySelectorAll('.dq-button').forEach(btn => {
        btn.style.pointerEvents = 'none';
        if (btn.textContent.includes(currentQuiz.a)) {
          btn.classList.add('correct-answer');
        } else {
          btn.classList.add('incorrect-answer');
        }
      });

      if (isCorrect) {
        correctCount++;
        hitSound();
        updateHpBars(100 - (correctCount * (100 / 4)));
        bossContainer.classList.add('shake');
        document.getElementById('explanation-title').textContent = TEXTS[currentLang].correct;
      } else {
        damageSound();
        document.querySelector('.dq-window').classList.add('shake');
        document.getElementById('explanation-title').textContent = TEXTS[currentLang].incorrect;
      }
      
      document.getElementById('explanation-text').textContent = currentQuiz.ex;
      nextQuestionButton.textContent = TEXTS[currentLang].nextButton;
      nextQuestionButton.dataset.nextIndex = index + 1;
      
      setTimeout(() => {
        explanationModal.style.display = 'flex';
      }, 800);
    }
    
    nextQuestionButton.addEventListener('click', () => {
      explanationModal.style.display = 'none';
      bossContainer.classList.remove('shake');
      document.querySelector('.dq-window').classList.remove('shake');
      
      const nextIndex = parseInt(nextQuestionButton.dataset.nextIndex);
      if (nextIndex >= TEXTS[currentLang].quiz.length) {
        showEndScreen();
      } else {
        displayQuestion(nextIndex);
      }
    });

    function showEndScreen() {
      clearInterval(timerInterval);
      bgm.pause();
      bgm.currentTime = 0;
      
      const isVictory = correctCount >= 4;
      if (isVictory) {
        victorySound();
        bossContainer.className = 'boss-defeat';
      } else {
        defeatSound();
      }
      
      setTimeout(() => {
        document.getElementById('boss-area').classList.add('hidden');
        switchScreen('result');
        const t = TEXTS[currentLang];
        document.getElementById('result-title').textContent = isVictory ? t.resultWinTitle : t.resultLoseTitle;
        document.getElementById('result-message').textContent = isVictory ? t.resultWinMsg : t.resultLoseMsg;
        submitResults();
      }, isVictory ? 1500 : 500);
    }

    async function submitResults() {
        const statusEl = document.getElementById('submission-status');
        let ipAddress = 'N/A';
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            ipAddress = (await response.json()).ip;
        } catch (error) {
            console.error('IP„Ç¢„Éâ„É¨„Çπ„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
        }

        // ‚òÖÂ§âÊõ¥: ÈÄÅ‰ø°„Åô„ÇãÂâç„Å´Á§æÂì°Áï™Âè∑„ÇíÊ≠£Ë¶èÂåñ
        const normalizedEmployeeId = normalizeEmployeeIdForHTML(employeeIdInput.value.trim());
        const payload = {
            employeeId: normalizedEmployeeId,
            stage: STAGE_NUMBER,
            score: correctCount,
            time: ((Date.now() - startTime) / 1000).toFixed(2),
            ipAddress: ipAddress
        };
        statusEl.textContent = TEXTS[currentLang].submitting;
        
        try {
            const response = await fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8',
                },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (result.status === 'success') {
                if (result.recorded === false) {
                    statusEl.textContent = TEXTS[currentLang].recordedFalse;
                } else {
                    statusEl.textContent = TEXTS[currentLang].submitSuccess;
                }
            } else {
                statusEl.textContent = result.message || TEXTS[currentLang].submitError;
            }
        } catch (err) {
            statusEl.textContent = TEXTS[currentLang].submitError;
            console.error('Error:', err);
        }
    }

    function updateHpBars(percentage) {
      const hpBar = document.getElementById('boss-hp-bar');
      hpBar.style.width = `${Math.max(0, percentage)}%`;
      if (percentage <= 25) hpBar.className = 'boss-hp-bar low';
      else if (percentage <= 50) hpBar.className = 'boss-hp-bar mid';
      else hpBar.className = 'boss-hp-bar full';
    }
    
    function handleMediaError(element) {
        console.error(`Error loading media: ${element.src}`);
        element.style.display = 'none'; 
    }

    document.getElementById('title-start-button').addEventListener('click', async () => {
      if (!audioStarted) { 
        await Tone.start();
        setupAudio();
      }
      clickSound();
      const openingVideo = document.getElementById('opening-video');
      openingVideo.muted = false;
      openingVideo.play().catch(e => console.log("User interaction might be needed for audio"));
      switchScreen('language');
    });

    document.getElementById('lang-ja').addEventListener('click', () => { clickSound(); currentLang = 'ja'; updateUIText(); switchScreen('instruction'); });
    document.getElementById('lang-en').addEventListener('click', () => { clickSound(); currentLang = 'en'; updateUIText(); switchScreen('instruction'); });
    document.getElementById('lang-zh').addEventListener('click', () => { clickSound(); currentLang = 'zh'; updateUIText(); switchScreen('instruction'); });
    
    document.getElementById('instruction-ok-button').addEventListener('click', () => {
      clickSound();
      openingVideoContainer.classList.add('hidden');
      document.getElementById('opening-video').pause();
      gameVideoContainer.classList.remove('hidden');
      document.getElementById('game-bg-video').play().catch(e => console.log("Game video play failed"));
      switchScreen('start');
    });
    
    startButton.addEventListener('click', startGame);
    document.getElementById('restart-button').addEventListener('click', () => location.reload());

    updateUIText();
    switchScreen('title');
    const openingVideo = document.getElementById('opening-video');
    openingVideo.muted = false;
    openingVideo.play().catch(e => {
        console.log("Autoplay with sound was prevented. Muting and retrying.");
        openingVideo.muted = true;
        openingVideo.play();
    });
  </script>
</body>
</html>
